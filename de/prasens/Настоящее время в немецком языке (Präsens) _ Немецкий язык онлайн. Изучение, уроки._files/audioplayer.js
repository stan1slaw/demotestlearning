(window.webpackJsonp=window.webpackJsonp||[]).push([["bundles/audioplayer"],{"4bNW":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return onRowOver});var _lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("zxIV"),_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Egk5"),_slicedToArray=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],o=!0,a=!1,s=void 0;try{for(var r,n=t[Symbol.iterator]();!(o=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){a=!0,s=t}finally{try{!o&&n.return&&n.return()}finally{if(a)throw s}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function onRowOver(audioEl,event,forceRedraw){var _this=this;Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.V)(audioEl,"podcast_list_snippet")||Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.V)(audioEl,"podcast_snippet__controls")||(Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(audioEl,"leaved",!1),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(audioEl,"actions")&&!forceRedraw||Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.V)(audioEl,"no_extra")||(clearTimeout(window.audioRowHoverTO),window.audioRowHoverTO=setTimeout(function(){var audio=AudioUtils.getAudioFromEl(audioEl),audioObject=AudioUtils.getAudioFromEl(audioEl,!0),actions=[],moreActions=[],context=AudioUtils.getContextPlaylist(audioEl,!0),_AudioUtils$contextSp=AudioUtils.contextSplit(context),_AudioUtils$contextSp2=_slicedToArray(_AudioUtils$contextSp,1),contextSection=_AudioUtils$contextSp2[0],extra=AudioUtils.getAudioExtra(audioObject);if(audioObject.isDeleted)if(AudioUtils.isPodcast(audioObject))actions.push(["add",AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"==contextSection)actions.push(["restore_recoms",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{var deleteRestoreInfo=AudioUtils.getAddRestoreInfo();deleteRestoreInfo[audioObject.fullId]&&deleteRestoreInfo[audioObject.fullId].deleteAll&&actions.push(["delete",AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{var actionsList=["next","add","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(AudioUtils.isPodcast(audioObject))actionsList=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.V)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"current_delete","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=["recoms","next","edit","add","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=vk.id?["add"]:[];else if(contextSection)switch(contextSection){case"my":case"search_owned_audios":case"module":case"user_list":case"group_list":actionsList=["recoms","edit","next","add","delete","share","open_album","add_to_playlist"];break;case"edit_playlist":actionsList=["add","next","edit"];break;case"recoms_recoms":actionsList=["recoms","next","add","recoms_delete","share","open_album","add_to_playlist"];break;case"recoms_recent_audios":actionsList=["recoms","edit","next","add","listened_delete","share","open_album","add_to_playlist"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add","share","open_album","add_to_playlist"])}actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&each(extra.moder_actions,function(i,act){moreActions.push(["moder_"+i,function(audioEl,audio){eval(act[1])},act[2]])});var ap=getAudioPlayer(),currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget&&(AudioUtils.isPodcast(audioObject)||inArray(contextSection,["my","group_list","search_owned_audios"]));each(actionsList,function(t,e){switch(e){case"next":audioObject.isCurrent||audioObject.isClaimed||AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":var i=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&(i=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=i&&actions.push(["add",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",function(){showAudioClaimWarning(audioObject,extra.claim,AudioUtils.replaceWithOriginal.bind(AudioUtils,audioEl,audioObject))},getLang("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",AudioUtils.isPodcast(audioObject)?AudioUtils.editEpisode:AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":!audioObject.canDelete||audioObject.isInRecomsBlock||vk.widget||actions.push(["delete",AudioUtils.isPodcast(audioObject)?AudioUtils.deleteEpisode:AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"current_delete":actions.push(["current_delete",AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms_delete":audioObject.isInRecomsBlock||actions.push(["recoms_delete",AudioUtils.deleteRecomsAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"listened_delete":audioObject.isInRecomsBlock||actions.push(["listened_delete",AudioUtils.deleteListenedAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"fave":AudioUtils.isPodcast(audioObject)&&actions.push(["fave",AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"share":audioObject.isClaimed||moreActions.push(["share",AudioUtils.shareAudio,getLang("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",getLang("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",AudioUtils.showAudioAlbum,getLang("audio_open_album")]);break;case"open_episode":AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",AudioUtils.openEpisode,getLang("audio_podcast_open_episode")])}}),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",AudioUtils.unclaim.bind(_this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",AudioUtils.claim.bind(_this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){var actionsEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.mb)('<div class="_audio_row__actions audio_row__actions"></div>');each(actions,function(t,e){var i=AudioUtils.getRowActionName(e[0],audioObject,audioEl),o=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.mb)('<button aria-label="'+i+'" data-action="'+e[0]+'" class="audio_row__action audio_row__action_'+e[0]+" _audio_row__action_"+e[0]+(" "+e[4]||!1)+'" '+(e[3]||"")+">"+(e[2]||"")+"</button>");o.addEventListener("click",function(t){return e[1]&&e[1].call(window,audioEl,audioObject,audio),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(t)}),actionsEl.appendChild(o)});var audioRestorationInfo=AudioUtils.getAddRestoreInfo()[audioObject.fullId];audioRestorationInfo&&"added"===audioRestorationInfo.state&&addClass(audioEl,"audio_row__added");var rowInfoEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.H)("_audio_row__info",audioEl),rowDurationEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.H)("_audio_row__duration",audioEl),rowAlreadyActionsEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.H)("_audio_row__actions",audioEl);if(!rowInfoEl)return;Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.fb)(rowAlreadyActionsEl),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.qb)(rowDurationEl,"visibility","hidden"),rowInfoEl.appendChild(actionsEl);var moreActionsBtnEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.H)("_audio_row__action_more",actionsEl);moreActions.length&&moreActionsBtnEl&&setMoreAction(audioEl,audio,audioObject,moreActions,moreActionsBtnEl),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(audioEl,"actions",1)}},forceRedraw?0:10)))}function setMoreAction(t,e,i,o,a){var s=gpeByClass("im-page_classic",t),r=gpeByClass("_im_peer_history_w",t),n=gpeByClass("_im_peer_history",t),l=gpeByClass("_im_chat_body_abs",t),u=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.mb)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),d=gpeByClass("wk_history_audio_content",t),_={};n?(_.getWrapEl=function(){return s?null:l},_.appendTo=n):d?_.appendTo=d:_.appendToParent=!0;var c=new ElementTooltip(a,extend({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:u,bottomGap:s&&r?parseInt(getStyle(r,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(t,e){Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.s)(e,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:function(){Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(t,"leaved")&&AudioUtils.onRowLeave(t)}},_));each(o,function(o,a){var s=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.mb)(Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.lb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,a));if("add_to_playlist"==a[0]){var r=void 0,n=void 0;s.addEventListener("mouseenter",r=function(){clearTimeout(n),n=setTimeout(function(){s.removeEventListener("mouseenter",r),AudioUtils.initRowPlaylistsChooser(e,s,c)},150)}),s.addEventListener("mouseleave",function(){clearTimeout(n)})}else s.addEventListener("click",function(e){return a[1].call(window,t,i),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(e)});u.appendChild(s)}),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(t,"tt",c)}},"4e3S":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";var _lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("98sY");function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var AudioLayer=function(){function AudioLayer(){_classCallCheck(this,AudioLayer),this._els={layerPlace:ge("top_audio_layer_place"),topPlayBtn:geByClass1("_top_audio_player_play"),topNotaBtn:geByClass1("_top_nav_audio_btn"),topNotaBtnGroup:ge("top_audio_btn_group")}}return AudioLayer.prepare=function(t){stManager.add(["audio.js","audio.css","suggester.js","auto_list.js","indexer.js"],function(){t&&t()})},AudioLayer.prototype.toggle=function(t,e){var i=this;this._initTooltip();var o=this._els.tooltip,a=void 0!==t?t:!o.isShown();a?(o.show(),cancelStackPush("top_audio",function(){i.toggle(!1,!0)},!0)):(e||cancelStackPop(),o.hide()),toggleClass(this._els.topNotaBtn,"active",a)},AudioLayer.prototype.hide=function(){this._els.tooltip.hide()},AudioLayer.prototype.isShown=function(){return this._els.tooltip&&this._els.tooltip.isShown()},AudioLayer.prototype.updatePosition=function(){return this._els.tooltip&&this._els.tooltip.updatePosition()},AudioLayer.prototype._layerPosition=function(){var t=getXY(this._els.layerPlace),e=getXY("ts_wrap")[0]-t[0]-1,i=0;isVisible(this._els.topNotaBtnGroup)?i=-e+(getXY(this._els.topNotaBtn)[0]-t[0])+15:i=-e+(getXY(this._els.topPlayBtn)[0]-t[0])+3;return{left:e,top:0,arrowPosition:i}},AudioLayer.prototype.getPageInstance=function(){return this._page},AudioLayer.prototype.getTemplate=function(){return'\n      <div class="audio_layer_container">\n        <div class="top_audio_loading">\n          '+rs(vk.pr_tpl,{id:"",cls:"pr_big"})+"\n        </div>\n      </div>\n    "},AudioLayer.prototype._initTooltip=function _initTooltip(){var _this2=this;this._els.tooltip||(this._els.container=se(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:function(){_this2._page&&_this2._page.onLayerHide()},onShow:function(){_this2._page&&_this2._page.onLayerShow(_this2._initSection)}}),ajax.post("al_audio.php",{act:"layer",is_layer:1,is_current_playlist:ap.getCurrentPlaylist()?1:0},{onDone:function onDone(html,data,templatesScript){try{eval(templatesScript)}catch(t){Object(_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.d)(t,templatesScript)}_this2._els.container.innerHTML=html,_this2._page=new AudioPage(geByClass1("_audio_page_layout",_this2._els.container),data),_this2._initSection="recoms"==data.initSection?data.initSection:void 0,_this2._page.onLayerShow(_this2._initSection)}}))},AudioLayer}();__webpack_exports__.a=AudioLayer},B3ia:function(t,e,i){"use strict";var o=i("4e3S"),a=i("pp2G"),s=i("zxIV");var r=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ap=getAudioPlayer(),this._el=e,this._playIconBtn=Object(s.F)("top_audio"),this._audioBtnGroup=Object(s.F)("top_audio_btn_group"),this.init()}return t.init=function(){var e=Object(s.F)("top_audio_player"),i=Object(s.i)(e,"object");i||(i=new t(e),Object(s.i)(e,"object",i))},t.prototype.init=function(){var t=this;function e(e){return Object(s.V)(this,"top_audio_player_play")?(t.ap.podcastSetActionRef(t.ap.getCurrentAudio(),t.ap.isPlaying()?a.a.PodcastsLogs.ACTION_PAUSE:a.a.PodcastsLogs.ACTION_PLAY,"top_player"),t.ap.isPlaying()?t.ap.pause():t.ap.play(),!1):Object(s.V)(this,"top_audio_player_prev")?(t.ap.playPrev(),!1):Object(s.V)(this,"top_audio_player_next")?(t.ap.playNext(),!1):void 0}this.ap.on(this,AudioPlayer.EVENT_UPDATE,this.onPlay.bind(this)),this.ap.on(this,AudioPlayer.EVENT_PLAY,this.onPlay.bind(this)),this.ap.on(this,AudioPlayer.EVENT_PAUSE,this.onPause.bind(this)),this.ap.top=this,each(["prev","play","next"],function(i,o){addEvent(Object(s.H)("top_audio_player_"+o,t._el),"click",e)}),addEvent(this._el,"mousedown",function(t){if(!Object(s.V)(Object(s.z)(t.target),"top_audio_player_btn"))return 1!=t.which||Object(s.V)(t.target,"top_audio_player_btn")||Object(s.V)(t.target,"top_audio_player_act_icon")||a.a.getLayer().toggle(),cancelEvent(t)}),addEvent(Object(s.F)("top_audio"),"mousedown",function(t){return!0!==checkEvent(t)&&(a.a.getLayer().toggle(),cancelEvent(t))}),browser.safari||addEvent(document,"keydown keyup",function(t){Object(s.vb)(Object(s.F)("top_audio_play"),"shuffle",t.shiftKey)}),this.onPlay(this.ap.getCurrentAudio())},t.prototype.onPlay=function(e,i,o){var r=this,n="top_audio_player_enabled";if(e){var l=function(){var i=getAudioPlayer();setTimeout(function(){var t=a.a.getLayer();t&&t.isShown()&&t.updatePosition()},1),Object(s.vb)(r._el,"audio_player_podcast",a.a.isPodcast(i.getCurrentAudio())),Object(s.a)(r._el,n),Object(s.vb)(r._el,"top_audio_player_playing",i.isPlaying());var l=Object(s.H)("_top_audio_player_play_blind_label");l&&(l.innerHTML=i.isPlaying()?getLang("global_audio_pause"):getLang("global_audio_play")),e=a.a.asObject(e),clearTimeout(r._currTitleReTO);var u=Object(s.H)("top_audio_player_title_out",r._el);Object(s.fb)(u);var d=Object(s.H)("top_audio_player_title",r._el);if(0!=o){var _=o<0?-10:10,c="opacity: 0; top: "+_+"px; left: "+d.offsetLeft+"px",p=e.performer+" &ndash; "+e.title,h=Object(s.mb)('<div class="top_audio_player_title top_audio_player_title_next" style="'+c+'">'+p+"</div>");h.setAttribute("onmouseover","setTitle(this)"),o>0?domInsertAfter(h,d):domInsertBefore(h,d),Object(s.a)(d,"top_audio_player_title_out"),Object(s.qb)(d,{top:-_,opacity:0}),setTimeout(function(){Object(s.qb)(h,{top:0,opacity:1})},10),clearTimeout(r._currTitleReTO),r._currTitleReTO=setTimeout(function(){Object(s.fb)(d),Object(s.hb)(h,"top_audio_player_title_next")},t.TITLE_CHANGE_ANIM_SPEED)}else d&&(d.innerHTML=e.performer+" &ndash; "+e.title,d.titleSet=0,d.setAttribute("onmouseover","setTitle(this)"))};o=intval(o),Object(s.V)(this._playIconBtn,n)?l():(Object(s.a)(this._playIconBtn,n),setTimeout(function(){Object(s.W)(r._audioBtnGroup),l()},150))}else{Object(s.hb)(this._playIconBtn,n),Object(s.hb)(this._el,n),Object(s.hb)(this._el,"top_audio_player_playing"),Object(s.hb)(this._el,"audio_player_podcast"),Object(s.tb)(this._audioBtnGroup);var u=Object(s.H)("top_audio_play__button",this._audioBtnGroup);u&&Object(s.hb)(u,"loading");var d=a.a.getLayer();d&&d.isShown()&&d.updatePosition()}},t.prototype.onPause=function(){Object(s.hb)(this._el,"top_audio_player_playing");var t=Object(s.H)("_top_audio_player_play_blind_label");t&&(t.innerHTML=getLang("global_audio_play"))},t.prototype.onNext=function(){},t}();r.TITLE_CHANGE_ANIM_SPEED=190;var n=i("D33C"),l=i("XLUH");var u=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.playerListen=function(t,e){this.player.on(e,t,e)},e.prototype.playerUnListen=function(t,e){this.player.off(e)},e.prototype.listenPlay=function(t,e){this.listen(AudioPlayer.EVENT_PLAY,t,e)},e.prototype.listenPause=function(t,e){this.listen(AudioPlayer.EVENT_PAUSE,t,e)},e.prototype.listenProgress=function(t,e){this.listen(AudioPlayer.EVENT_PROGRESS,t,e)},e.prototype.listenVolume=function(t,e){this.listen(AudioPlayer.EVENT_VOLUME,t,e)},e.prototype.listenSeek=function(t,e){this.listen(AudioPlayer.EVENT_SEEK,t,e)},e.prototype.listenPlaylistChanged=function(t,e){this.listen(AudioPlayer.EVENT_PLAYLIST_CHANGED,t,e)},e.prototype.listenEnded=function(t,e){this.listen(AudioPlayer.EVENT_ENDED,t,e)},e.prototype.listenPlayNext=function(t,e){this.listen(AudioPlayer.EVENT_PLAY_NEXT,t,e)},e.prototype.listenAdCompleted=function(t,e){this.listen(AudioPlayer.EVENT_AD_COMPLETED,t,e)},e.prototype.useNewStats=function(){var t=this.player.getCurrentAudio();return!!t&&Boolean(t[a.a.AUDIO_ITEM_INDEX_NEW_STATS])},e.prototype.getPausedBy=function(t){var e=this.player,i=e.pausedByVideo,o=e.pausedByStories,a=e.pausedByAudio,s=e.pausedByQueue;return i&&t<i||window.Videoview&&Videoview.isLayerShown()?"video":o&&t<o||window.cur&&cur.storyLayer?"stories":a&&t<a?"audio":s&&t<s?"queue":null},e.prototype.getState=function(){var e=t.prototype.getState.call(this),i=this.getAudioId();if(i){var o=Object(s.G)("_audio_row_"+i+" audio_row__current",Object(s.F)("page_layout"));if(o&&o.length)return l.b}return e},e.prototype.getProgress=function(){return this.player.getCurrentProgress()},e.prototype.getProgressInSeconds=function(){var t=this.player.getCurrentAudio();return t?Math.round(this.player.getCurrentProgress()*t[a.a.AUDIO_ITEM_INDEX_DURATION]):0},e.prototype.getVolume=function(){return Math.round(100*(t=this.player.getVolume(),Math.log(1+34*t)/Math.log(35)));var t},e.prototype.getAudioId=function(){var t=this.player.getCurrentAudio();if(t)return t[a.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[a.a.AUDIO_ITEM_INDEX_ID]},e.prototype.getAudioTrackCode=function(){var t=this.player.getCurrentAudio();if(t)return t[a.a.AUDIO_ITEM_INDEX_TRACK_CODE]},e.prototype.getPrevAudioId=function(){var t=this.player._prevAudio;if(t)return t[a.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[a.a.AUDIO_ITEM_INDEX_ID]},e.prototype.getPrevPlaylistId=function(){var t=this.player._prevPlaylist;if(t)return t.getFullId()},e.prototype.getPlaylistId=function(){var t=this.player.getCurrentPlaylist();if(t)return t.getFullId()},e.prototype.getContext=function(){return this.player._getPlayingContext()},e.prototype.getSequence=function(){return this.player._seq},e.prototype.getType=function(){if(this.player._impl)return this.player._impl.type},e.prototype.getListenedTime=function(){var t=Math.round(this.player._listenedTime);return isNaN(t)?0:t||0},e.prototype.getSearchParams=function(){var t=this.player.getCurrentPlaylist();if(t)return t.getSearchParams()},e.prototype.isShuffledPlaylist=function(){var t=this.player.getCurrentPlaylist();if(t)return t.isShuffled()},e.prototype.isRealPlaylist=function(){var t=this.player.getCurrentPlaylist();return!!t&&t.getType()===AudioPlaylist.TYPE_PLAYLIST},e.prototype.isRealPrevPlaylist=function(){var t=this.player._prevPlaylist;return!!t&&t.getType()===AudioPlaylist.TYPE_PLAYLIST},e.prototype.isPodcast=function(){var t=this.player.getCurrentAudio();return a.a.isPodcast(t)},e.prototype.isLastTrack=function(){var t=this.player.getCurrentAudio(),e=this.player.getCurrentPlaylist();return!!t&&(!(!t||e)||e.indexOfAudio(t)+1===e.getAudiosCount())},e.prototype.hasPlaylist=function(){return Boolean(this.player.getCurrentPlaylist())},e.prototype.hasSearchParams=function(){return this.getContext()===AudioPlaylist.TYPE_SEARCH},e.prototype.isDebug=function(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))},e.prototype.sendListenedData=function(t){var e=this,i=this.player.getListenedHash();!i&&window.cur&&cur.audioPage&&(i=cur.audioPage._data.listenedHash);var o=extend({act:"listened_data",impl:this.getType(),hash:i,v:5,loc:nav.strLoc},t);isArray(cur.audioLoadTimings)&&(o.timings=cur.audioLoadTimings.join(","),cur.audioLoadTimings=[]),ajax.post("al_audio.php",o,{onDone:function(t){e.player._adsConfig=t}})},e}(l.a),d=i("6ng+"),_="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",c={v:function(t){return t.split("").reverse().join("")},r:function(t,e){t=t.split("");for(var i,o=_+_,a=t.length;a--;)~(i=o.indexOf(t[a]))&&(t[a]=o.substr(i-e,1));return t.join("")},s:function(t,e){var i=t.length;if(i){var o=function(t,e){var i=t.length,o=[];if(i){var a=i;for(e=Math.abs(e);a--;)e=(i*(a+1)^e+a)%i,o[a]=e}return o}(t,e),a=0;for(t=t.split("");++a<i;)t[a]=t.splice(o[i-1-a],1,t[a])[0];t=t.join("")}return t},i:function(t,e){return c.s(t,e^vk.id)},x:function(t,e){var i=[];return e=e.charCodeAt(0),each(t.split(""),function(t,o){i.push(String.fromCharCode(o.charCodeAt(0)^e))}),i.join("")}};function p(t){if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~t.indexOf("audio_api_unavailable")){var e=t.split("?extra=")[1].split("#"),i=""===e[1]?"":h(e[1]);if(e=h(e[0]),"string"!=typeof i||!e)return t;for(var o,a,s=(i=i?i.split(String.fromCharCode(9)):[]).length;s--;){if(o=(a=i[s].split(String.fromCharCode(11))).splice(0,1,e)[0],!c[o])return t;e=c[o].apply(null,a)}if(e&&"http"===e.substr(0,4))return e}return t}function h(t){if(!t||t.length%4==1)return!1;for(var e,i,o=0,a=0,s="";i=t.charAt(a++);)~(i=_.indexOf(i))&&(e=o%4?64*e+i:i,o++%4)&&(s+=String.fromCharCode(255&e>>(-2*o&6)));return s}function f(t,e){if(!window.Worker||!window.Blob)return setTimeout(t,e);var i=new Blob(["\n      var timeout;\n      onmessage = function(e) {\n        clearTimeout(timeout);\n        if (e.data == 'start') {\n          timeout = setTimeout(function() { postMessage({}); }, \" + delay + \");\n        }\n      }\n    "]);try{var o=new Worker(window.URL.createObjectURL(i));return o.onmessage=function(){o.terminate(),t()},o.postMessage("start"),o}catch(i){return setTimeout(t,e)}}var A="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type="html5",this.opts=e||{},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}return t.prototype.destroy=function(){},t.prototype.getPlayedTime=function(){for(var t=this._currentAudioEl.played,e=0,i=0;i<t.length;i++)e+=t.end(i)-t.start(i);return e},t.prototype.clearAudioNode=function(){this._currentAudioEl=this._createAudioNode(A)},t.prototype._setAudioNodeUrl=function(t,e){var i=p(e),o=i===A;Object(s.i)(t,"setUrlTime",o?0:vkNow()),this._currentHls&&(t===this._currentAudioEl||o)&&(this._currentHls.destroy(),this._currentHls=null),this._isHlsUrl(i)?this._initHls(t,i):t.src=i},t.prototype._isHlsUrl=function(t){return/\.m3u8/.test(p(t))},t.prototype._initHls=function(t,e){var i=this;if(window.Hls){var o=new Hls({debug:!!ls.get("audio_hls_debug"),maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5});o.attachMedia(t),o.loadSource(e),this._currentHls=o,this._hlsError=null,o.on(Hls.Events.ERROR,function(t,e){e.details===Hls.ErrorDetails.BUFFER_STALLED_ERROR&&(o.stopLoad(),o.startLoad()),e.fatal&&(console.log("audio hls error",t,e),i._hlsError={type:e.type,details:e.details,url:e.frag&&e.frag.url||e.context&&e.context.url,code:e.networkDetails?e.networkDetails.status:0},i.opts.onFail&&i.opts.onFail())});var a=getAudioPlayer();a.isPlaying()&&!a.isAdPlaying()&&this.play(e)}else stManager.add("hls.min.js",function(){i._currentAudioEl===t&&i._initHls(t,e)})},t.prototype._createAudioNode=function(t){var e=this,i=new Audio;return this.opts.onBufferUpdate&&addEvent(i,"progress",function(){e._currentAudioEl===i&&e.opts.onBufferUpdate(e.getCurrentBuffered());var t=i.buffered;1===t.length&&0===t.start(0)&&t.end(0)===i.duration&&(i._fullyLoaded=!0)}),this.opts.onProgressUpdate&&addEvent(i,"timeupdate",function(){e._currentAudioEl===i&&e.opts.onProgressUpdate(e.getCurrentProgress(),e.getPlayedTime())}),this.opts.onEnd&&addEvent(i,"ended",function(){e._currentAudioEl===i&&e.opts.onEnd()}),this.opts.onSeeked&&addEvent(i,"seeked",function(){e._currentAudioEl===i&&e.opts.onSeeked()}),this.opts.onSeek&&addEvent(i,"seeking",function(){e._currentAudioEl===i&&e.opts.onSeek()}),addEvent(i,"error",function(){AudioUtils.debugLog("HTML5 error track loading"),e._prefetchAudioEl===i?e._prefetchAudioEl=e._createAudioNode():e._currentAudioEl===i&&i.src!==A&&e.opts.onFail&&e.opts.onFail()}),addEvent(i,"canplay",function(){var t=Object(s.i)(i,"setUrlTime");t&&(cur.audioLoadTimings=cur.audioLoadTimings||[],cur.audioLoadTimings.push(vkNow()-t),Object(s.i)(i,"setUrlTime",0)),e._currentAudioEl===i&&(e.opts.onCanPlay&&e.opts.onCanPlay(),Object(s.i)(i,"canplay",!0))}),addEvent(i,"durationchange",function(){e._currentAudioEl===i&&e._seekOnReady&&isFinite(i.duration)&&(e.seek(e._seekOnReady),e._seekOnReady=!1)}),i.crossOrigin="anonymous",t&&(this._setAudioNodeUrl(i,t),i.preload="auto",i.volume=this._volume||1,i.load()),this._audioNodes.push(i),this._audioNodes.length>10&&this._audioNodes.splice(0,5),i},t.prototype.onReady=function(t){t(!0)},t.prototype.prefetch=function(t){this._isHlsUrl(t)||(this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,A),this._prefetchAudioEl=this._createAudioNode(t))},t.prototype.seek=function(t){var e=this._currentAudioEl;isFinite(e.duration)&&e.src&&e.src!==A?e.currentTime=e.duration*t:this._seekOnReady=t},t.prototype.setVolume=function(t){void 0===t&&(t=this._currentAudioEl.volume),this._currentAudioEl.volume=t,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=t),this._volume=t},t.prototype.setPlaybackRate=function(t){this._currentAudioEl.playbackRate=t},t.prototype.getCurrentProgress=function(){var t=this._currentAudioEl;return isNaN(t.duration)?0:Math.max(0,Math.min(1,t.currentTime/t.duration))},t.prototype.getCurrentBuffered=function(){var t=this._currentAudioEl;return t&&t.buffered.length?Math.min(1,t.buffered.end(0)/t.duration):0},t.prototype.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.prototype.setUrl=function(t,e){var i=this;if(!t)return e&&e(!1);var o=p(t),a=this._currentAudioEl;return a.src&&a.src!==A&&(this._seekOnReady=!1),a.src===o||this._currentHls&&this._currentHls.url===o?(this.opts.onCanPlay&&this.opts.onCanPlay(),e&&e(!0)):(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>0&&(this._prefetchAudioEl.src===o?(this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,A),this._prefetchAudioEl.readyState>=3&&setTimeout(function(){return i.opts.onCanPlay&&i.opts.onCanPlay()}),this._currentAudioEl=this._prefetchAudioEl,a=this._currentAudioEl,this._prefetchAudioEl=!1):this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,A)),a.src!==o&&(this._setAudioNodeUrl(a,o),a.load(),Object(s.i)(this._currentAudioEl,"canplay",null),this._stopFrequencyAnalise()),e&&e(!0))},t.prototype.playAudioEl=function(t){var e=t.play();isUndefined(e)||e.catch(function(e){e.code!==e.ABORT_ERR&&f(function(){return triggerEvent(t,"error",!1,!0)},10)})},t.prototype.play=function(t){this._stopFrequencyAnalise(),this._prefetchAudioEl.src===p(t)&&this._prefetchAudioEl.readyState>0&&(this._setAudioNodeUrl(this._currentAudioEl,A),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var e=this._currentAudioEl;e.src&&(this.playAudioEl(e),this._startFrequencyAnalise())},t.prototype.preparePlay=function(){if(browser.safari){var t=this._currentAudioEl;this.playAudioEl(t)}},t.prototype._startFrequencyAnalise=function(){var t=this;function e(t,e,i,o){return(i-e)*t/o+e}function i(t,e){return Math.random()*(e-t)+t}this._stopFrequencyAnalise();var o=999,a=null,r=null;this._freqUpdateInterval=setInterval(function(){var n=void 0;t._currentAudioEl.paused||!Object(s.i)(t._currentAudioEl,"canplay")?n=[0,0,0,0]:(++o>3&&(o=0,a=r,r=[i(.7,1),i(.55,.8),i(.3,.55),i(.03,.45)],a||(a=[i(.7,1),i(.55,.8),i(.3,.55),i(.03,.45)])),n=[e(o,a[0],r[0],3),e(o,a[1],r[1],3),e(o,a[2],r[2],3),e(o,a[3],r[3],3)]),t.opts&&t.opts.onFrequency(n)},50)},t.prototype._stopFrequencyAnalise=function(){this._stopFrequencyAnaliseCallback&&this._stopFrequencyAnaliseCallback(),delete this._stopFrequencyAnaliseCallback,clearInterval(this._freqUpdateInterval),this.opts&&this.opts.onFrequency([0,0,0,0])},t.prototype.pause=function(){var t=this._currentAudioEl;if(t.src){var e=t.pause();void 0!=e&&e.catch(function(){})}this._stopFrequencyAnalise()},t.prototype.stop=function(){this._currentAudioEl.pause(),this._currentAudioEl=this._createAudioNode(A),this._stopFrequencyAnalise()},t.prototype._setFadeVolumeInterval=function(t){if(t){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var e=new Blob(["\n          var interval;\n          onmessage = function(e) {\n            clearInterval(interval);\n            if (e.data == 'start') {\n              interval = setInterval(function() { postMessage({}); }, 20);\n            }\n          }\n        "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(e))}catch(t){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=t,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(t,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.prototype.fadeVolume=function(t,e){var i=this;t=Math.max(0,Math.min(1,t));var o=this._currentAudioEl,a=0;if(a=t<o.volume?-.06:.001,Math.abs(t-o.volume)<=.001)return this._setFadeVolumeInterval(),e&&e();var s=o.volume;this._setFadeVolumeInterval(function(){a>0&&(a*=1.35),s+=a;if(a<0?s<=t:s>=t)return i.setVolume(t),i._setFadeVolumeInterval(),e&&e();i.setVolume(s)})},t.prototype.getErrorData=function(){var t=this._currentAudioEl.error||{};return{is_hls:this._currentHls?1:0,url:this._currentHls?this._currentHls.url:this._currentAudioEl.currentSrc,error_code:t.code,error_message:t.message,hls_error:this._hlsError?JSON.stringify(this._hlsError):null}},t}();y.isSupported=function(){var t="undefined"!=typeof navigator?navigator.userAgent:"";if(/(Windows NT 5.1|Windows XP)/.test(t)&&(browser.vivaldi||browser.opera||browser.mozilla))return AudioUtils.debugLog("Force no HTML5 (xp vivaldi / opera / mozilla)"),!1;if(/(Windows 7|Windows NT 6.1)/.test(t)&&(browser.vivaldi||browser.opera))return AudioUtils.debugLog("Force no HTML5 (win7 vivaldi / opera)"),!1;var e=document.createElement("audio");if(e.canPlayType){var i=e.canPlayType('audio/mpeg; codecs="mp3"'),o=!!i.replace(/no/,"");return AudioUtils.debugLog("HTML5 browser support "+(o?"yes":"no"),i,t),o}return AudioUtils.debugLog("audio.canPlayType is not available",t),!1};var g=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type="flash",this.opts=e||{},window._flashAudioInstance=this}return t.onAudioFinishCallback=function(){var t=window._flashAudioInstance;t.opts.onEnd&&t.opts.onEnd()},t.onAudioProgressCallback=function(t,e){if(e){var i=window._flashAudioInstance;i._total=e,i._currProgress=t/e,i.opts.onProgressUpdate&&i.opts.onProgressUpdate(i._currProgress,t)}},t.onAudioLoadProgressCallback=function(t,e){var i=window._flashAudioInstance;i._currBuffered=t/e,i.opts.onBufferUpdate&&i.opts.onBufferUpdate(i._currBuffered)},t.prototype.fadeVolume=function(t,e){return this.setVolume(t),e()},t.prototype._startFrequencyAnalise=function(){var t=this;function e(t,e,i,o){return(i-e)*t/o+e}function i(t,e){return Math.random()*(e-t)+t}this._stopFrequencyAnalise();var o=999,a=null,s=null;this._freqUpdateInterval=setInterval(function(){var r;++o>3&&(o=0,a=s,s=[i(.7,1),i(.55,.8),i(.3,.55),i(.03,.45)],a||(a=[i(.7,1),i(.55,.8),i(.3,.55),i(.03,.45)])),r=[e(o,a[0],s[0],3),e(o,a[1],s[1],3),e(o,a[2],s[2],3),e(o,a[3],s[3],3)],t.opts.onFrequency(r)},50)},t.prototype._stopFrequencyAnalise=function(){this._stopFrequencyAnaliseCallback&&this._stopFrequencyAnaliseCallback(),delete this._stopFrequencyAnaliseCallback,clearInterval(this._freqUpdateInterval),this.opts.onFrequency([0,0,0,0])},t.prototype.destroy=function(){Object(s.fb)("flash_audio")},t.prototype.onReady=function(t){var e=this;if(this._player)return t(!0);if(!1===this._player)return t(!1);this._onReady=t;Object(s.F)("flash_audio")||document.body.appendChild(Object(s.e)("div",{id:"flash_audio",className:"fixed"})),renderFlash("flash_audio",{url:"/swf/audio_lite.swf",id:"player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"AudioPlayerFlash.onAudioFinishCallback",onLoadProgress:"AudioPlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"AudioPlayerFlash.onAudioProgressCallback"})&&setTimeout(function(){return e._checkFlashLoaded()},50)},t.prototype.setUrl=function(t,e){var i=p(t);this._url!==i?(this._url=i,this._player&&this._player.loadAudio(i),e&&e(!0)):e&&e(!0)},t.prototype.setVolume=function(t){this._player&&this._player.setVolume&&this._player.setVolume(t)},t.prototype.setPlaybackRate=function(){return!1},t.prototype.play=function(){this._player&&this._player.playAudio(),this._startFrequencyAnalise()},t.prototype.seek=function(t){var e=(this._total||0)*t;this._player&&this._player.playAudio(e)},t.prototype.pause=function(){this._player&&this._player.pauseAudio(),this._stopFrequencyAnalise()},t.prototype.isFullyLoaded=function(){return!1},t.prototype.getPlayedTime=function(){return 0},t.prototype.getCurrentProgress=function(){return this._currProgress||0},t.prototype.getCurrentBuffered=function(){return this._currBuffered||0},t.prototype.stop=function(){this._player&&this._player.stopAudio(),this._stopFrequencyAnalise()},t.prototype._checkFlashLoaded=function(){var t=this,e=Object(s.F)("player");if(this._checks=this._checks||0,this._checks++,this._checks>10)return this._player=!1,this._onReady&&this._onReady(!1);e&&e.paused?(this._player=e,this._onReady&&this._onReady(!0),this._onReady=null):setTimeout(function(){return t._checkFlashLoaded()},100)},t.prototype.getErrorData=function(){return{url:this._url}},t}(),E=i("xk4V");var P=function(){function t(){var e=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._currentAudio=!1,this._isPlaying=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlists=[],this.subscribers=[],this._tasks=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!1,!vk.isBanned){a.a.debugLog("Player creation");var i=new u(this);this.stats=new d.a(i),this._initImpl(),this._initEvents(),this._restoreVolumeState(),this._podcastCleanStates(),setTimeout(function(){e.restoreState(),a.a.toggleAudioHQBodyClass(),e.updateCurrentPlaying()})}}return t.getVersion=function(){return 15},t._sendLCNotification=function(){var t=window.Notifier;t&&t.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(t){}},t.showHQLabel=function(t){var e="_audio_show_hq_label";return void 0===t?!!ls.get(e):(t=!!t,ls.set(e,t),a.a.toggleAudioHQBodyClass(),t)},t.getDeviceId=function(){var e=ls.get(t.LS_PREFIX+t.LS_UUID);return e||(e=E(),ls.set(t.LS_PREFIX+t.LS_UUID,e)),e},t.showSubscriptionPopup=function(){showBox("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})},t.getDurationType=function(){return intval(ls.get(t.LS_PREFIX+t.LS_DURATION_TYPE))},t._setTabIcon=function(e){setFavIcon(t.tabIcons[e])},t._lsGet=function(e){return ls.get(t.LS_PREFIX+e)},t._lsSet=function(e,i){ls.set(t.LS_PREFIX+e,i)},t._podcastGetStates=function(){return(t._lsGet(t.LS_PODCASTS)||{}).states||{}},t._podcastSetStates=function(e){var i=t._lsGet(t.LS_PODCASTS)||{};i.states=e,t._lsSet(t.LS_PODCASTS,i)},t.podcastToggleFave=function(t,e){if(e){e=a.a.asObject(e);var i=a.a.getAudioExtra(e).faveHash;i&&bookmarkPodcast(t,e.fullId,i)}},t.podcastGetPlaybackRate=function(){return(t._lsGet(t.LS_PODCASTS)||{}).rate||1},t.getLang=function(t){var e=getAudioPlayer();return e&&e.langs?e.langs[t]:t},t.clearDeprecatedCacheKeys=function(){t._iterateCacheKeys(function(e){return e===t.LS_VER})},t.clearOutdatedCacheKeys=function(){(ls.get(t.LS_PREFIX+t.LS_SAVED)||0)<vkNow()-72e5&&t._iterateCacheKeys(function(e,i){return!inArray(i,[t.LS_PL,t.LS_TRACK,t.LS_PROGRESS])})},t.clearAllCacheKeys=function(){t._iterateCacheKeys(function(){return!1}),setCookie("remixcurr_audio","",-1)},t._iterateCacheKeys=function(e){for(var i in window.localStorage)if(0===i.indexOf(t.LS_KEY_PREFIX+"_")){var o=i.split("_");e(o[1],o[2])||localStorage.removeItem(i)}},t.prototype._initImpl=function(e){var i=this;this._impl&&this._impl.destroy();var o=0,s=function(e){if(-1!==o){if(e&&(o++,i._implSetDelay(200),o>3)){o=-1;var s=new MessageBox({title:getLang("global_error")}).content(getLang("audio_error_loading")).setButtons("Ok",function(){o=0,curBox().hide()});return s.show(),f(function(){o=0,s.hide()},3e3),i.notify(t.EVENT_ENDED),void i.notify(t.EVENT_FAILED)}a.a.isPodcast(i.getCurrentAudio())?(i._isPlaying=!1,i.notify(t.EVENT_PAUSE),i.notify(t.EVENT_ENDED),i.stop()):i._repeatCurrent?(i._autoNext=!0,i.notify(t.EVENT_ENDED),i.notify(t.EVENT_PLAY),i.notify(t.EVENT_PROGRESS,0),i._implSeekImmediate(0),f(function(){i._impl&&i._impl.clearAudioNode&&(i._impl.clearAudioNode(),i._implSetUrl(i.getCurrentAudio())),i._implPlay()})):(i._isPlaying=!1,i.notify(t.EVENT_PAUSE),i.notify(t.EVENT_ENDED),i.playNext(!0)),i._sendListenedData()}},r={onBufferUpdate:function(e){i.notify(t.EVENT_BUFFERED,e)},onEnd:s,onFail:function(){i._sendPlayerErrorStats(i._impl),s(!0)},onCanPlay:function(){return i.notify(t.EVENT_CAN_PLAY)},onProgressUpdate:function(e,o){var s=i.getCurrentAudio();!i._muteProgressEvents&&s&&i.notify(t.EVENT_PROGRESS,e,s[a.a.AUDIO_ITEM_INDEX_DURATION],o)},onFrequency:function(e){i.notify(t.EVENT_FREQ_UPDATE,e)}};a.a.debugLog("Implementation init"),a.a.debugLog("param browser.flash",browser.flash),a.a.debugLog("param force HTML5",!!e),e?this._impl=new y(r):y.isSupported()?this._impl=new y(r):browser.flash&&(this._impl=new g(r)),this._implSetVolume(0)},t.prototype.onMediaKeyPressedEvent=function(t){var e=this.getCurrentAudio();this.getCurrentPlaylist();if(e)switch(t.keyCode){case 179:this.isPlaying()?this.pause():this.play();break;case 178:this.seek(0),this.pause();break;case 177:this.playPrev();break;case 176:this.playNext()}},t.prototype.deletePlaylist=function(t){for(var e=0;e<this._playlists.length;e++)this._playlists[e]===t&&this._playlists.splice(e,1)},t.prototype.mergePlaylistData=function(t,e){if(!t.hasMore())return t;each(this._playlists,function(i,o){o.getId()===t.getId()&&o.mergeWith(e)})},t.prototype.deleteCurrentPlaylist=function(){this.stop(),delete this._currentAudio,delete this._currentPlaylist,this.notify(t.EVENT_UPDATE),this.notify(t.EVENT_PLAYLIST_CHANGED),this.updateCurrentPlaying()},t.prototype.updateCurrentPlaying=function(t){t=!!t;var e=a.a.asObject(this.getCurrentAudio()),i=[];if(e){var o=geByClass("_audio_row_"+e.fullId);i=i.concat([].slice.call(o))}for(var s=0,r=this._currentPlayingRows.length;s<r;s++){var n=this._currentPlayingRows[s];n&&!inArray(n,i)&&this.toggleCurrentAudioRow(n,!1,t)}if(e)for(var l=0,u=i.length;l<u;l++){var d=i[l];if(d){if(gpeByClass("article_editor_canvas",d))continue;this.toggleCurrentAudioRow(d,!0,t)}}this._currentPlayingRows=i,each(geByClass("_audio_pl"),function(t,e){return removeClass(e,"audio_pl__playing")});var _=this.getCurrentPlaylist();if(this.isPlaying()&&_){var c=geByClass("_audio_pl_"+_.getOwnerId()+"_"+_.getPlaylistId());c&&each(c,function(t,e){return addClass(e,"audio_pl__playing")})}},t.prototype.toggleCurrentAudioRow=function(t,e,i){var o=this,s=a.a.getAudioFromEl(t,!0);s.isCurrent!==e&&(addClass(t,a.a.AUDIO_CURRENT_CLS),s.withInlinePlayer&&toggleClass(t,"audio_row__player_transition",i),(i=!!s.withInlinePlayer&&i)?setTimeout(function(){return o._updateAudioEl(e,t,s,i)},0):this._updateAudioEl(e,t,s,i))},t.prototype._updateAudioEl=function(e,i,o,s){var r=this,n=geByClass1("_audio_row__play_btn",i),l=geByClass1("_audio_row__title",i),u=geByClass1("_audio_row__duration",i),d=a.a.getDurationMod(e?o.duration:o.duration*this.getCurrentProgress()),_=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(u){var i=a.a.getDurationMod(t);u.innerHTML=e+formatTime(t),i!==d&&(replaceClass(u,a.a.AUDIO_DURATION_CLS+"-"+d,a.a.AUDIO_DURATION_CLS+"-"+i),d=i)}};if(o.withInlinePlayer&&(e?this._addRowPlayer(i):this._removeRowPlayer(i)),e){this.on(i,t.EVENT_PLAY,function(t){a.a.asObject(t).fullId===o.fullId&&(addClass(i,a.a.AUDIO_PLAYING_CLS),n&&attr(n,"aria-label",getLang("global_audio_pause")),l&&attr(l,"role","heading"))}),this.on(i,t.EVENT_PROGRESS,function(e,i,a){if(o.withInlinePlayer||!r.isAdPlaying()){a=intval(a);var s=0,n="";t.getDurationType()?(s=Math.round(a-i*a),n="-"):s=Math.round(i*a),_(s,n)}else _(o.duration)}),this.on(i,[t.EVENT_PAUSE,t.EVENT_ENDED],function(){removeClass(i,a.a.AUDIO_PLAYING_CLS),n&&attr(n,"aria-label",getLang("global_audio_play")),l&&attr(l,"role","")});var c=data(i,"bars");if(!c&&(o.isWithCovers||o.isNumeric||o.isPodcastListSnippet)){if(c=se('<canvas class="audio_row__sound_bars"></canvas>'),o.isPodcastListSnippet?geByClass1("podcast_list_snippet__cover",i).appendChild(c):i.appendChild(c),c.width=a.a.AUDIO_ROW_COVER_SIZE*(isRetina()?2:1),c.height=a.a.AUDIO_ROW_COVER_SIZE*(isRetina()?2:1),c.style.width=a.a.AUDIO_ROW_COVER_SIZE,c.style.height=a.a.AUDIO_ROW_COVER_SIZE,isRetina())c.getContext("2d").scale(2,2);var p=o.isNumeric;this.on(i,t.EVENT_FREQ_UPDATE,function(t,e){return v(c,e,p)}),v(c,[0,0,0,0],p),data(i,"bars",c)}toggleClass(i,a.a.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(i),removeClass(i,a.a.AUDIO_PLAYING_CLS),removeClass(i,a.a.AUDIO_CURRENT_CLS),_(o.duration),n&&attr(n,"aria-label",getLang("global_audio_play")),l&&attr(l,"role","");var h=data(i,"bars");h&&(re(h),data(i,"bars",null))}s?setTimeout(function(){var t=a.a.getAudioFromEl(i,!0);toggleClass(i,a.a.AUDIO_CURRENT_CLS,!!t.isCurrent)},0):toggleClass(i,a.a.AUDIO_CURRENT_CLS,e)},t.prototype._removeRowPlayer=function(t){removeClass(t,a.a.AUDIO_CURRENT_CLS);var e=data(t,"player_inited");if(e){setTimeout(function(){return re(geByClass1("_audio_inline_player",t))},200);var i=geByClass1("_audio_duration",t);i&&(i.innerHTML=formatTime(a.a.getAudioFromEl(t,!0).duration)),this.off(t),each(e.sliders,function(t,e){return e.destroy()}),data(t,"player_inited",!1);var o=geByClass1("has_audio_player",t);o&&removeClass(o,"has_audio_player")}},t.prototype._addRowPlayer=function(e){var i=this;if(!(geByClass1("_audio_inline_player",e)||hasClass(e,"podcast_list_snippet")||hasClass(e,"podcast_snippet__controls"))){var o=se(vk.audioInlinePlayerTpl||getTemplate("audio_inline_player")),s=geByClass1("_audio_player__place",e);s.appendChild(o),addClass(s,"has_audio_player");var r=new Slider(geByClass1("audio_inline_player_volume",o),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:function(t){return Math.round(100*t)+"%"},onChange:function(t){return i.setVolume(t)}}),n=new Slider(geByClass1("audio_inline_player_progress",o),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:function(t){var e=a.a.asObject(i.getCurrentAudio());return formatTime(Math.round(t*e.duration))},onEndDragging:function(t){var e=a.a.asObject(i.getCurrentAudio());e&&a.a.isPodcast(e)&&i.podcastSetActionRef(e,a.a.PodcastsLogs.ACTION_SEEK,"",o),i.seek(t)}});this.isAdPlaying()&&n.toggleAdState(!0),this.on(e,t.EVENT_AD_DEINITED,function(){}),this.on(e,t.EVENT_AD_READY,function(){}),this.on(e,t.EVENT_AD_STARTED,function(){n.toggleAdState(!0),n.setBackValue(0)}),ap.on(e,t.EVENT_AD_COMPLETED,function(){return n.toggleAdState(!1)}),ap.on(e,t.EVENT_START_LOADING,function(){return n.toggleLoading(!0)}),ap.on(e,t.EVENT_CAN_PLAY,function(){return n.toggleLoading(!1)}),ap.on(e,t.EVENT_BUFFERED,function(t,e){return n.setBackValue(e)}),ap.on(e,t.EVENT_PROGRESS,function(t,e){n.toggleLoading(!1),n.setValue(e)}),ap.on(e,t.EVENT_VOLUME,function(t,e){r.setValue(e)}),data(e,"player_inited",{sliders:[r,n]})}},t.prototype.hasStatusExport=function(){for(var t in this._statusExport)if(this._statusExport.hasOwnProperty(t)&&this._statusExport[t])return!0;return!1},t.prototype.getStatusExportInfo=function(){return this._statusExport},t.prototype.setStatusExportInfo=function(t){this._statusExport=t},t.prototype.deleteAudioFromAllPlaylists=function(t){t=isObject(t)||isArray(t)?a.a.asObject(t).fullId:t,each(this._playlists,function(e,i){return i.removeAudio(t)})},t.prototype.updateAudio=function(e,i){var o=this,s="";return isString(e)?s=e:isArray(e)&&(s=a.a.asObject(e).fullId),i||(i=e),each(this._playlists,function(t,e){for(var o=e.getAudiosList(),r=function(t,e){o[t][a.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+o[t][a.a.AUDIO_ITEM_INDEX_ID]===s&&(isObject(i)&&each(i,function(e,i){return o[t][e]=i}),isArray(i)&&(o[t]=i))},n=0,l=o.length;n<l;n++)r(n)}),this._currentAudio[a.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+this._currentAudio[a.a.AUDIO_ITEM_INDEX_ID]===s&&(isObject(i)&&each(i,function(t,e){return o._currentAudio[t]=e}),isArray(i)&&(this._currentAudio=i,this.notify(t.EVENT_CURRENT_CHANGED))),this.notify(t.EVENT_UPDATE),e},t.prototype._triggerTNSPixel=function(){var e=t._lsGet("tns_triggered_time_v3")||0,i=vkNow();i-e<864e5||(t._lsSet("tns_triggered_time_v3",i),vkImage().src="https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/"+irand(1,1e9))},t.prototype._restoreVolumeState=function(){t.clearDeprecatedCacheKeys(),t.clearOutdatedCacheKeys();var e=t._lsGet(t.LS_VOLUME);this._userVolume=void 0==e||!1===e?t.DEFAULT_VOLUME:e},t.prototype.restoreState=function(){if(!vk.widget&&(t.clearDeprecatedCacheKeys(),t.clearOutdatedCacheKeys(),!window.cur.audioPreventRestoreTrack)){this._currentAudio=t._lsGet(t.LS_TRACK);var e=t._lsGet(t.LS_PL);e&&(e=JSON.parse(e),this._currentPlaylist=new AudioPlaylist(e),this._initPlayingContext(e.context),e.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=e.originalPlaylistRawId)),this._currentPlaylist&&this._currentAudio?this.notify(t.EVENT_UPDATE):this._currentPlaylist=this._currentAudio=!1;var i=0;if(a.a.isPodcast(this._currentAudio))i=((t._podcastGetStates()[this._currentAudio[a.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+this._currentAudio[a.a.AUDIO_ITEM_INDEX_ID]]||{}).position||0)/this._currentAudio[a.a.AUDIO_ITEM_INDEX_DURATION];else i=t._lsGet(t.LS_PROGRESS)||0;this._currentAudio&&i&&this._impl&&0===this._impl.type.indexOf("html5")&&(this._implSetUrl(this._currentAudio,!0),i<1&&this._implSeek(i),this._implSetVolume(0)),this.notify(t.EVENT_CURRENT_CHANGED),this._updatePlaybackRate()}},t.prototype._ensureImplReady=function(t){var e=this;this._impl&&this._impl.onReady(function(i){if(i)return t();"flash"===e._impl.type&&(a.a.debugLog("Flash not initialized, lets try HTML5 as desperate way"),e._initImpl(!0))})},t.prototype._implNewTask=function(t,e){this._taskIDCounter=this._taskIDCounter||1,this._tasks=this._tasks||[],this._tasks.push({name:t,cb:e,id:t+"_"+this._taskIDCounter++}),this._implDoTasks()},t.prototype._implDoTasks=function(){var t=this;if(this._tasks=this._tasks||[],!this._taskInProgress){var e=this._tasks.shift();e&&(e=clone(e),this._taskInProgress=e.id,this._ensureImplReady(function(){e.cb.call(t,function(){t._taskAbort!==e.id?(t._taskInProgress=!1,t._implDoTasks()):t._taskAbort=!1})}))}},t.prototype._implClearAllTasks=function(){this._taskAbort=this._taskInProgress,this._taskInProgress=!1,this._tasks=[]},t.prototype._implClearTask=function(t){this._tasks=this._tasks||[],this._tasks=this._tasks.filter(function(e){return e.name!==t})},t.prototype._implSetDelay=function(t){this._implNewTask("delay",function(e){f(e,t)})},t.prototype._implPlay=function(){var e=this;this._implNewTask("play",function(i){var o=a.a.asObject(e.getCurrentAudio());if(e._impl.play(o.url),e._muteProgressEvents=!1,e._allowPrefetchNext=!0,o.actionHash&&(a.a.connectListenQueue(),ajax.post("al_audio.php",{act:"start_playback",audio_id:o.id,owner_id:o.owner_id,hash:o.actionHash,uuid:t.getDeviceId()})),a.a.isPodcast(o)){var s=e._podcastRestoreState();e._podcastUpdateState(o,s,0,a.a.PodcastsLogs.ACTION_PLAY)}i()})},t.prototype._implSeekImmediate=function(t){this._impl&&this._impl.seek(t)},t.prototype._implSeek=function(t){var e=this;this._implClearTask("seek"),this._implNewTask("seek",function(i){e._impl.seek(t),i()})},t.prototype._implPause=function(){var t=this;this._implNewTask("pause",function(e){t._impl.pause(),e()})},t.prototype._implSetVolume=function(t,e){var i=this;if(this._impl)if(e){var o=t?"vol_up":"vol_down";this._implNewTask(o,function(e){i._impl.fadeVolume(t,function(){return e()})})}else this._implNewTask("vol_set",function(e){i._impl.setVolume(t),e()})},t.prototype._implSetUrl=function(e,i){var o=this;this._implClearTask("url"),this._implNewTask("url",function(s){i||o.notify(t.EVENT_START_LOADING);var r=o._taskInProgress;o._ensureHasURL(e,function(t){r===o._taskInProgress&&(t=a.a.asObject(t),o._impl.setUrl(t.url,function(t){t||(o._implClearAllTasks(),o._onFailedUrl()),s()}))})})},t.prototype.toggleDurationType=function(){var e=t.LS_PREFIX+t.LS_DURATION_TYPE,i=intval(ls.get(e));ls.set(e,!i),this.notify(t.EVENT_UPDATE,this.getCurrentProgress())},t.prototype.getCurrentProgress=function(){return this._impl?this._impl.getCurrentProgress():0},t.prototype.getCurrentBuffered=function(){return this._impl?this._impl.getCurrentBuffered():0},t.prototype._initEvents=function(){var e=this,i=window.Notifier;i&&(i.addRecvClbk("audio_start","audio",function(){e.isPlaying()&&(e.pausedByAudio=vkNow(),e.pause()),delete e.pausedByVideo}),i.addRecvClbk("video_start","audio",function(){e.isPlaying()&&(e.pause(),e.pausedByVideo=vkNow())}),i.addRecvClbk("video_hide","audio",function(){!e.isPlaying()&&e.pausedByVideo&&(vkNow()-e.pausedByVideo<18e4&&e.play(),delete e.pausedByVideo)}),i.addRecvClbk("logged_off","audio",function(){cur.loggingOff=!0,t.clearAllCacheKeys(),e.stop()}),i.addRecvClbk("stories_video_start","audio",function(){e.isPlaying()&&(e.pause(),e.pausedByStories=vkNow())}),i.addRecvClbk("stories_video_end","audio",function(){!e.isPlaying()&&e.pausedByStories&&(vkNow()-e.pausedByStories<18e4&&e.play(),delete e.pausedByStories)}))},t.prototype.addPlaylist=function(t){this.hasPlaylist(t.getId())||this._playlists.push(t)},t.prototype._cleanUpPlaylists=function(){for(var t=0,e=-1,i=this._playlists.length-1;i>=0;i--){var o=this._playlists[i];if(!o.isReference()&&(t+=o.getAudiosCount())>4e3){e=i;break}}if(-1!==e){e+=1;for(var a=this._playlists.slice(0,e),s=this.getCurrentPlaylist(),r=[],n=0;n<a.length;n++){var l=a[n];if(s===l&&(l=!1),l&&!l.isReference())for(var u=e;u<this._playlists.length;u++){var d=this._playlists[u];d.isReference()&&d.getSelf()===l&&(l=!1)}l&&r.push(n)}for(var _=0;_<r.length;_++){var c=r[_];this._playlists.splice(c,1)}r.length&&debugLog("AudioPlayer - "+r.length+" playlists removed")}},t.prototype.hasPlaylist=function(t,e,i){var o=void 0;o=void 0!==e&&void 0!==i?t+"_"+e+"_"+i:t;for(var a=0;a<this._playlists.length;a++){var s=this._playlists[a];if(!s.isReference()&&s.getId()===o)return s}return!1},t.prototype.getPlaylist=function(t,e,i,o){if(t&&!e&&!i){var a=t.split("_");t=a[0],e=a[1],i=a[2]}var s=this.hasPlaylist(t,e,i);return s?(s.mergeWith({accessHash:o}),s):new AudioPlaylist({type:t,ownerId:e,albumId:i,hasMore:t!==AudioPlaylist.TYPE_TEMP,accessHash:o})},t.prototype.isFromNextSequence=function(){return 1===this._seq},t.prototype.isFromPrevSequence=function(){return-1===this._seq},t.prototype.isAutoPlayed=function(){return!!this._autoNext},t.prototype.hasPrevAudio=function(){return!(!this._prevAudio||a.a.getAudioFullId(this._currentAudio)===a.a.getAudioFullId(this._prevAudio))},t.prototype.hasPrevPlaylist=function(){return!!this._prevPlaylist},t.prototype.toggleRepeatCurrentAudio=function(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1},t.prototype.isRepeatCurrentAudio=function(){return!!this._repeatCurrent},t.prototype.toggleRepeatAll=function(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1},t.prototype.isRepeatAll=function(){return!!this._repeatAll},t.prototype.setNext=function(e,i,o){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;if(!hasClass(e,"audio_row__added_next")){addClass(e,"audio_row__added_next");var s=this.getCurrentPlaylist();if(s){var r=a.a.asObject(this.getCurrentAudio());if(r&&i.fullId===r.fullId)return;var n=s.indexOfAudio(r);if(-1===n)return;this.notify(t.EVENT_PLAY_NEXT,i.fullId);var l=s.indexOfAudio(i);-1!==l?s.moveAudio(l,n+1):s.addAudio(o,n+1)}else{var u=a.a.getContextPlaylist(e);this.play(o,u.playlist,u.context)}var d=window.AudioPage&&currentAudioPage(e);if(d){var _=d.getPageCurrentPlaylist();_&&d.onUserAction(i,_)}}},t.prototype.on=function(t,e,i){var o=this;isArray(e)||(e=[e]),each(e,function(e,a){return o.subscribers.push({context:t,et:a,cb:i})})},t.prototype.off=function(t){this.subscribers=this.subscribers.filter(function(e){return e.context!==t})},t.prototype.notify=function(e,i,o,s){var r=this.getCurrentAudio(),n=a.a.asObject(r);if(this._impl&&(this.isAdPlaying()||!this._muteProgressEvents||!inArray(e,[t.EVENT_BUFFERED,t.EVENT_PROGRESS])))switch(inArray(e,[t.EVENT_PLAY,t.EVENT_PAUSE])&&(this.subscribers=this.subscribers.filter(function(t){return!(t.context instanceof Element)||bodyNode.contains(t.context)}),this.updateCurrentPlaying(!0)),each(this.subscribers||[],function(t,a){a.et===e&&a.cb(r,i,o,s)}),e){case t.EVENT_VOLUME:t._lsSet(t.LS_VOLUME,this._userVolume);break;case t.EVENT_PLAY:this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),t._setTabIcon("play"),this._sendStatusExport();break;case t.EVENT_PLAYLIST_CHANGED:this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio();break;case t.EVENT_PROGRESS:if(this._listenedTime=s,a.a.isPodcast(n))i&&s&&this._podcastUpdateState(n,i,s,a.a.PodcastsLogs.ACTION_HEARTBEAT);else if(!this._adsIsAdPlaying()){var l=this.getCurrentPlaylist(),u=this._impl.getCurrentProgress();if(vk.widget||t._lsSet(t.LS_PROGRESS,u),this._trackListenedData(n,l,s,this._getPlayingContext()),!vk.widget&&this._allowPrefetchNext&&u>=.8){var d=l.getNextAudio(r);d&&this._impl.isFullyLoaded()&&(this._allowPrefetchNext=!1,this._prefetchAudio(d))}}break;case t.EVENT_PAUSE:a.a.isPodcast(n)&&this._podcastUpdateState(n,this.getCurrentProgress(),this._impl.getPlayedTime(),a.a.PodcastsLogs.ACTION_PAUSE);var _=this.getCurrentPlaylist();this._trackListenedData(n,_,s,this._getPlayingContext()),t._setTabIcon("pause");break;case t.EVENT_SEEK:a.a.isPodcast(n)&&this._podcastUpdateState(n,this.getCurrentProgress(),this._impl.getPlayedTime(),a.a.PodcastsLogs.ACTION_SEEK);break;case t.EVENT_ENDED:a.a.isPodcast(n)&&this._podcastUpdateState(n,this.getCurrentProgress(),this._impl.getPlayedTime(),a.a.PodcastsLogs.ACTION_HEARTBEAT)}},t.prototype._trackListenedDataSwitch=function(t,e,i){if(this._currentAudioListenData){this._switchPlaylistRef||(this._switchPlaylistRef=this._currentPlaylist);var o=0,a=this.isAutoPlayed(),s=e&&this._prevContext!==e,r=this._switchPlaylistRef&&i&&this._switchPlaylistRef.getId()!==i.getId();this._seq&&!a?o="next_btn":(s||r)&&(o="playlist_change"),!o&&a&&(o="playlist_next"),this._currentAudioListenData.end_stream_reason=o||"unknown",this._switchPlaylistRef=i}},t.prototype._trackListenedData=function(t,e,i,o){var s=this;if(i=Math.round(i)||0){var r=a.a.asObject(t);if(!r.useNewStats){var n={audio_id:r.fullId,listened:i,context:o};vk.widget&&(n.ref=cur.widgetReferrer||""),e&&(o===AudioPlaylist.TYPE_SEARCH&&(n.search_params=JSON.stringify(e.getSearchParams())),e.getType()===AudioPlaylist.TYPE_PLAYLIST&&(n.playlist_id=e.getFullId&&e.getFullId()),e.isShuffled()&&(n.shuffled=1)),t.trackCode&&(n.track_code=t.trackCode),this.isRepeatCurrentAudio()&&(n.repeat="one"),this.isAutoPlayed()&&(n.auto=1),this.hasPrevAudio()&&(n.prev_audio_id=a.a.asObject(this._prevAudio).fullId),this.hasPrevPlaylist()&&this._prevPlaylist.getType()===AudioPlaylist.TYPE_PLAYLIST&&(n.prev_playlist_id=this._prevPlaylist.getFullId&&this._prevPlaylist.getFullId()),this.isPlaying()||(n.end_stream_reason="stop_btn"),n.state=document.hidden?"background":"app",this._currentAudioListenData=n,clearTimeout(this._sendListenedTO),this._sendListenedTO=setTimeout(function(){s._sendListenedData()},1e4)}}},t.prototype._sendListenedData=function(){var t=this;clearTimeout(this._sendListenedTO);var e=this._currentAudioListenData;if(this._currentAudioListenData=!1,e&&e.listened&&this.getListenedHash()){var i=extend({act:"listened_data",impl:this._impl.type,hash:this.getListenedHash(),v:5,loc:nav.strLoc},e);isArray(cur.audioLoadTimings)&&(i.timings=cur.audioLoadTimings.join(","),cur.audioLoadTimings=[]),ajax.post("al_audio.php",i,{onDone:function(e){return t._adsConfig=e}})}},t.prototype._sendPlayerErrorStats=function(t){var e=a.a.asObject(this.getCurrentAudio());if(e){var i=e.full_id,o=extend({audio:i,impl_type:t.type,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},t.getErrorData());ajax.post("al_audio.php?act=player_error_stats",o)}},t.prototype.playLive=function(t,e){var i=this,o=this.getPlaylist(AudioPlaylist.TYPE_LIVE,vk.id,data[0]);o.mergeWith({live:t,hasMore:!1}),t=o.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:t.audioId,host_id:t.hostId,hash:t.hash},extend(e,{onDone:function(t,e,a){o.mergeWith({title:e&&e.title,list:[t]}),i.play(t,o,a)}}))},t.prototype._sendStatusExport=function(){var t=a.a.asObject(this.getCurrentAudio());if(t){var e=this.statusSent?this.statusSent.split(","):[!1,0],i=vkNow()-intval(e[1]);if(this.hasStatusExport()&&!a.a.isPodcast(t)&&(t.id!=e[0]||i>3e5)){var o=this.getCurrentPlaylist(),s=o?o.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:t.fullId,hash:vk.statusExportHash,top:intval(s&&(s.top_audio||s.top))}),0),this.statusSent=t.id+","+vkNow()}}},t.prototype.saveStateCurrentPlaylist=function(){if(!vk.widget){var e=this.getCurrentPlaylist();t._lsSet(t.LS_PL,e?e.serialize():null),t._lsSet(t.LS_SAVED,vkNow())}},t.prototype._saveStateCurrentAudio=function(){if(!vk.widget){var e=this.getCurrentAudio();if(e){var i=clone(e);i[a.a.AUDIO_ITEM_INDEX_URL]="",t._lsSet(t.LS_TRACK,i),setCookie("remixcurr_audio",e[a.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[a.a.AUDIO_ITEM_INDEX_ID],1)}else t._lsSet(t.LS_TRACK,null),setCookie("remixcurr_audio",null,1)}},t.prototype.seekCurrentAudio=function(t){if(this._adsIsAdPlaying())return!1;var e=10/a.a.asObject(this.getCurrentAudio()).duration,i=this.getCurrentProgress()+(t?e:-e);i=Math.max(0,Math.min(1,i)),this.seek(i)},t.prototype.setVolume=function(e){var i=Math.min(1,Math.max(0,e));this._userVolume=i,this._implSetVolume(i),this._adsUpdateVolume(),this.notify(t.EVENT_VOLUME,i)},t.prototype.getVolume=function(){return void 0===this._userVolume?.8:this._userVolume},t.prototype.seek=function(e){this._implSeekImmediate(e),this.notify(t.EVENT_SEEK)},t.prototype.seekToTime=function(t,e){var i=this.getCurrentAudio();if(!i)return 0;var o=t/i[a.a.AUDIO_ITEM_INDEX_DURATION];if(o=Math.max(0,o),o=Math.min(o,1),this.seek(o),a.a.isPodcast(i)){var s="",r=a.a.asObject(i);e&&(s=a.a.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(r,a.a.PodcastsLogs.ACTION_SEEK,e)),this._podcastUpdateState(r,o,0,s)}return o},t.prototype._ensureHasURL=function(t,e){var i=this,o=[];this._currentUrlEnsure=this._currentUrlEnsure||{};var s=a.a.asObject(t);if(s){if(s.url)return e&&e(t);var r=this.getCurrentPlaylist(),n=r.indexOfAudio(t);if(n>=0)for(var l=n;l<n+5;l++){var u=a.a.asObject(r.getAudioAt(l));!u||u.url||this._currentUrlEnsure[u.fullId]||(o.push(u.fullId+"_"+u.actionHash+"_"+u.urlHash),this._currentUrlEnsure[u.fullId]=!0)}o.push(s.fullId),o.length&&ajax.post("al_audio.php",{act:"reload_audio",ids:o.join(",")},{onDone:function(o,r,n,l){getAudioPlayer().setStatusExportInfo(r),i._listenedHash=n,l&&getAudioPlayer()._podcastSaveData(l),each(o,function(e,o){o=a.a.asObject(o);var r={};r[a.a.AUDIO_ITEM_INDEX_URL]=o.url,r[a.a.AUDIO_ITEM_INDEX_ADS]=o.ads,s.fullId===o.fullId&&(r[a.a.AUDIO_ITEM_INDEX_FLAGS]=o.flags,r[a.a.AUDIO_ITEM_INDEX_EXTRA]=o.extra),i.updateAudio(o.fullId,r),s.fullId===o.fullId&&(t[a.a.AUDIO_ITEM_INDEX_URL]=o.url,t[a.a.AUDIO_ITEM_INDEX_ADS]=o.ads,t[a.a.AUDIO_ITEM_INDEX_FLAGS]=o.flags,t[a.a.AUDIO_ITEM_INDEX_EXTRA]=o.extra),i._currentAudio&&a.a.asObject(i._currentAudio).fullId===o.fullId&&(i._currentAudio[a.a.AUDIO_ITEM_INDEX_URL]=o.url,i._currentAudio[a.a.AUDIO_ITEM_INDEX_ADS]=o.ads,i._currentAudio[a.a.AUDIO_ITEM_INDEX_FLAGS]=o.flags,i._currentAudio[a.a.AUDIO_ITEM_INDEX_EXTRA]=o.extra),delete i._currentUrlEnsure[o.fullId]}),e&&e(t)}})}},t.prototype.toggleAudio=function(t,e){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;if(domClosest("_audio_row__tt",e.target))return cancelEvent(e);var i=domClosest("_audio_row",t),o=a.a.getAudioFromEl(i,!0);if(window.getSelection&&window.getSelection().rangeCount){var s=window.getSelection().getRangeAt(0);if(s){var r=s.commonAncestorContainer;if(r&&domClosest("_audio_row",r)===i&&s.startOffset!==s.endOffset)return!1}}if(e&&hasClass(e.target,"mem_link"))return nav.go(attr(e.target,"href"),e,{navigateToUploader:!0}),cancelEvent(e);if(hasClass(e.target,"_audio_row__title_inner")){if(a.a.isPodcast(o))return showPodcast(i,o.fullId),cancelEvent(e);if(o.lyrics&&!o.isInAttach)return a.a.toggleAudioLyrics(i,o),cancelEvent(e)}if(hasClass(e.target.parentNode,"audio_row__performers")){if(checkEvent(e)||vk.widget)return!0;if(!gpeByClass("_ape_audio_item",e.target)){var n=domData(e.target,"performer");if(n)return a.a.audioSearchPerformer(e.target,n,e),cancelEvent(e)}return!0}var l=cur.cancelClick||e&&(hasClass(e.target,"audio_lyrics")||domClosest("_audio_duration_wrap",e.target)||domClosest("_audio_inline_player",e.target)||domClosest("audio_performer",e.target)),u=hasClass(e.target,"slider")||domClosest("slider",e.target),d=cur._sliderMouseUpNowEl&&cur._sliderMouseUpNowEl===geByClass1("audio_inline_player_progress",i);if(u&&d&&(l=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,l)return!0;if(a.a.isClaimedAudio(o)||o.isReplaceable){var _=a.a.getAudioExtra(o).claim;if(_)return void(hasClass(i,"no_actions")||o.isInEditBox||showAudioClaimWarning(o,_,a.a.replaceWithOriginal.bind(a.a,i,o)))}if(this.podcastSetActionRef(o,o.isPlaying?a.a.PodcastsLogs.ACTION_PAUSE:a.a.PodcastsLogs.ACTION_PLAY,"",i),o.isPlaying)this.pause();else{var c=a.a.getContextPlaylist(i);this.play(o.fullId,c.playlist,o.context||c.context),cur.audioPage&&cur.audioPage.onUserAction(o,c.playlist)}a.a.onRowOver(i,!1,!0)},t.prototype._onFailedUrl=function(){this.notify(t.EVENT_FAILED),this.isPlaying()&&(this.pause(),this.playNext(!0,!0))},t.prototype._startAdsPlay=function(t,e,i,o){var a=this;this._startAdsTO&&function(t){if(!t)return!1;isNumeric(t)?clearTimeout(t):t.terminate()}(this._startAdsTO),i?this._startAdsTO=f(function(){return a._checkAdsPlay(t,e,o)},200):this._checkAdsPlay(t,e,o)},t.prototype._checkAdsPlay=function(e,i,o){var s=this._getPlayingContextSection(),r=this._adsIsAllowed(e,i),n=r.type,l=r.reason,u=function(){return o&&o()};switch(e=a.a.asObject(e),n){case t.ADS_ALLOW_ALLOWED:this._adsFetchAd(e,s,!1,u);break;case t.ADS_ALLOW_DISABLED:u();break;case t.ADS_ALLOW_REJECT:this._adsFetchAd(e,s,!0,!1,l),u()}},t.prototype.playNextPlaylist=function(e,i,o){var a=this,s=this.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,i,o);s.loadAll(function(){var e=a.getCurrentPlaylist();if(e)e.addAudio(s.getAudiosList());else{a._currentPlaylist=new AudioPlaylist(s);var i=s.getAudioAt(0);i&&(a._currentAudio=i,a.notify(t.EVENT_UPDATE),a.notify(t.EVENT_PLAYLIST_CHANGED),a.updateCurrentPlaying())}}),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()},t.prototype.playPlaylist=function(t,e,i,o,a){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;this.playNextInPlaylist(t,e,i,o,{shuffled:a,preDoPlay:function(t){a&&(t.isShuffled()&&t.shuffle(0),t.shuffle(irand(1,999999),!0))}})},t.prototype.playBlock=function(t,e,i,o,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"default";this.playNextInPlaylist(t,e,i,o,{type:a,trackType:s,shuffled:!1})},t.prototype.playNextInPlaylist=function(t,e,i,o){var a=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=this.getCurrentPlaylist(),n=this.getPlaylist(s.type||AudioPlaylist.TYPE_PLAYLIST,t,e,i);if(r&&r.getId()===n.getId()&&this.isPlaying()&&!s.shuffled)this.pause();else{var l=function(){s.preDoPlay&&s.preDoPlay(n);var t=n.getNextAudio(!1,!0);t&&a.play(t,n,o)};n.load(0,l,null,s.trackType),n.getAudiosCount()&&!s.shuffled?l():this._impl&&this._impl.preparePlay&&!this.isAdPlaying()&&this._impl.preparePlay()}},t.prototype._initPlayingContext=function(t){this._playingContext=t},t.prototype.getListenedHash=function(){return this._listenedHash||""},t.prototype._getPlayingContext=function(){return this._playingContext||""},t.prototype._getPlayingContextSection=function(){return this._getPlayingContext().split(":")[0]},t.prototype.play=function(e,i,o,s,r){var n=this;if(!cur.loggingOff)if(this._impl){this._seq=s,this._autoNext=r,this._prevAudio=this._currentAudio,this._cleanUpPlaylists(),(isObject(e)||isArray(e))&&(e=a.a.asObject(e))&&(e=e.fullId);var l=a.a.asObject(this._currentAudio),u=this.getCurrentPlaylist();!e&&l&&(e=l.fullId);var d=!1,_=e&&l&&e==l.fullId;i?u&&(d=i==u.getSelf()||i==u):(i=u,d=!0),d||o||debugLog("New playlist play init without context"),o&&(this._prevContext=this._playingContext,this._initPlayingContext(o));var c=i.getAudio(e);c&&i.load(i.indexOfAudio(c)+3),_||(this._trackListenedDataSwitch(l,o,i),this._sendListenedData(),i.getType()===AudioPlaylist.TYPE_SEARCH&&i.indexOfAudio(c)>=i.getLocalFoundCount()&&i.sendSearchStats("search_play"),l&&a.a.isPodcast(l)&&this.isPlaying()&&this._podcastUpdateState(l,this.getCurrentProgress(),this._impl.getPlayedTime(),a.a.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0})),_||this._adsIsAdPlaying()||this._adsDeinit(),_&&d?this._adsIsAdPlaying()?this._adsResumeAd():this.isPlaying()||(this._isPlaying=!0,t._sendLCNotification(),this.notify(t.EVENT_PLAY),_||this.notify(t.EVENT_PROGRESS,0),this._implClearAllTasks(),this._implSetVolume(0),this._implSetUrl(c),this._implPlay(),this._updatePlaybackRate(),this._implSetVolume(this.getVolume(),!0),a.a.isPodcast(c)&&this._podcastUpdateState(a.a.asObject(c),this.getCurrentProgress(),this._impl.getPlayedTime())):e&&c&&(this._currentAudio=c,d||(this._currentPlaylist&&(this._prevPlaylist=this._currentPlaylist,this._prevAudio=this._currentAudio),this._currentPlaylist=new AudioPlaylist(i),this.notify(t.EVENT_PLAYLIST_CHANGED)),this.notify(t.EVENT_CURRENT_CHANGED),this._isPlaying=!0,this.updateCurrentPlaying(!0),this._adsIsAdPlaying()?(this.notify(t.EVENT_PLAY,!0),this._adsResumeAd()):(t._sendLCNotification(),this.notify(t.EVENT_PLAY,!0,intval(s),r),this.notify(t.EVENT_PROGRESS,0),this._muteProgressEvents=!0,this._implClearAllTasks(),this._impl.preparePlay&&this._impl.preparePlay(),r?this._startAdsPlay(c,i,!1,function(){(c=n.getCurrentAudio())&&n.isPlaying()&&(n.notify(t.EVENT_UPDATE),n._implSetUrl(c),n._implPlay(),n._updatePlaybackRate(),n._implSetVolume(n.getVolume()),n._triggerTNSPixel())}):(this._implSetVolume(0,!0),this._implPause(),this._startAdsPlay(c,i,!0,function(){(c=n.getCurrentAudio())&&n.isPlaying()&&(n.notify(t.EVENT_UPDATE),n._implSetUrl(c),n._implPlay(),n._updatePlaybackRate(),n._implSetVolume(n.getVolume()),n._triggerTNSPixel())}))))}else a.a.showNeedFlashBox()},t.prototype.preloadDefaultPlaylist=function(e){browser.safari&&!t._lsGet(t.LS_TRACK)&&this.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID,e).load()},t.prototype.instantPlay=function(t,e,i){var o=!browser.safari&&e&&e.shiftKey;this.playPlaylist(vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID,i,"header",o),statlogsValueEvent("client_header_play_button",o?"shuffle":"play"),setTimeout(function(){addClass(t,"loading")},400)},t.prototype._prefetchAudio=function(t){(t=a.a.asObject(t))&&t.url&&this._impl.prefetch&&this._impl.prefetch(t.url)},t.prototype.getCurrentPlaylist=function(){return this._currentPlaylist},t.prototype.getPlaylists=function(){return clone(this._playlists)},t.prototype.pause=function(){this._adsIsAdPlaying()&&this._adsPauseAd(),this._isPlaying=!1,this.notify(t.EVENT_PAUSE),this._implSetVolume(0,!0),this._implPause()},t.prototype.stop=function(){this._isPlaying=!1,this._impl.stop(),this.notify(t.EVENT_STOP)},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.getCurrentAudio=function(){return this._currentAudio},t.prototype.playNext=function(t){this._playNext(1,t)},t.prototype.playPrev=function(){this._playNext(-1)},t.prototype._playNext=function(e,i){var o=this;if(!this._adsIsAdPlaying()){var s=10,r=this.getCurrentAudio(),n=this.getCurrentPlaylist(),l=function(t,e){a.a.isClaimedAudio(t)||o.play(t,n,!1,e,i)};if(r&&n)if(e>0){for(var u=n.getNextAudio(r);s&&u&&a.a.isClaimedAudio(u);)u=n.getNextAudio(u),s--;if(u)l(u,1);else if(n.isLive())this._muteProgressEvents=!0,n.fetchNextLiveAudio(function(t){return l(t,1)});else{if(u=n.getAudioAt(0),a.a.isClaimedAudio(u))for(var d=n.getAudiosList(),_=n.getAudiosCount(),c=0;c<_;c++){var p=d[c];if(!a.a.isClaimedAudio(p)){u=p;break}}if(!this.isRepeatAll())if(n.indexOfAudio(r)+1===n.getAudiosCount())return this._implSeekImmediate(0),this.stop(),void(a.a.isClaimedAudio(u)||(this._currentAudio=u,this.updateCurrentPlaying(!0),this.notify(t.EVENT_CURRENT_CHANGED),this.notify(t.EVENT_UPDATE)));l(u,1)}}else{var h=n.indexOfAudio(this._currentAudio)-1;if(h<0)this.seek(0);else{for(var f=n.getAudioAt(h);s&&f&&a.a.isClaimedAudio(f);)f=n.getAudioAt(--h),s--;f?l(f,-1):this.seek(0)}}}},t.prototype._adsPlayAd=function(e,i,o){var a=this;this._adman.onCompleted(function(){a._adsDeinit(!0),e?a._adsSendAdEvent("statistics",i):(a.notify(t.EVENT_PROGRESS,0),a.notify(t.EVENT_AD_COMPLETED),delete a._adsPlaying,delete a._adsCurrentProgress,a._adsSendAdEvent("completed",i),setDocumentTitle(a._adsPrevTitle),o&&o())}),this._adman.onStarted(function(){e||(a._isPlaying=!0,a.notify(t.EVENT_PROGRESS,0),a.notify(t.EVENT_AD_STARTED),a._adsUpdateVolume(),a._adsSendAdEvent("started",i))});var s=[.25,.5,.75];if(this._adman.onTimeRemained(function(e){a._adsCurrentProgress=e.percent/100,a.notify(t.EVENT_PROGRESS,a._adsCurrentProgress,e.duration),each(s,function(t,e){if(a._adsCurrentProgress>=e)return s.shift(),a._adsSendAdEvent("progress_"+intval(100*e),i),!1})}),this._adman.start(t.AD_TYPE),e)return o&&o();this._adsPlaying=!0,this.notify(t.EVENT_PLAY),this.notify(t.EVENT_PROGRESS,0),this._adsPrevTitle=document.title,setDocumentTitle(getLang("global_audio_ad"))},t.prototype._adsUpdateVolume=function(){this._adman&&this._adman.setVolume(.7*this.getVolume())},t.prototype._adsSendAdEvent=function(e,i,o,a){var s=this,r=o?"/"+o:"",n=a?"/"+a:"";this._adEvents=this._adEvents||[],this._adEvents.push(e+"/"+i+r+n),clearTimeout(this._adEventDelay),this._adEventDelay=setTimeout(function(){ajax.post("al_audio.php",{act:"ad_event",events:s._adEvents.join(","),v:t.getVersion(),abp:intval(window.abp)}),s._adEvents=[]},500)},t.prototype.adsGetCurrentProgress=function(){return this._adsCurrentProgress||0},t.prototype._adsPauseAd=function(){this._adman&&(this._isPlaying=!1,this._adman.pause(),this.notify(t.EVENT_PAUSE))},t.prototype._adsResumeAd=function(){this._adman&&(this._isPlaying=!0,this._adman.resume(),this.notify(t.EVENT_PLAY))},t.prototype._adsIsAdPlaying=function(){return this._adsPlaying},t.prototype.isAdPlaying=function(){return this._adsIsAdPlaying()},t.prototype._adsDeinit=function(e){this._adman=null,!e&&this.notify(t.EVENT_AD_DEINITED)},t.prototype._adsIsAllowed=function(e){if(vk.widget)return{type:t.ADS_ALLOW_DISABLED};if(a.a.isPodcast(e))return{type:t.ADS_ALLOW_DISABLED};if(cur.adsPreview)return{type:t.ADS_ALLOW_ALLOWED};if(window.browser&&window.browser.safari)return{type:t.ADS_ALLOW_DISABLED};var i=this._adsConfig||vk.audioAdsConfig;return i?i.enabled?i.day_limit_reached?{type:t.ADS_ALLOW_REJECT,reason:t.REJECT_REASON_LIMIT}:inArray(this._getPlayingContextSection(),i.sections)?{type:t.ADS_ALLOW_ALLOWED}:{type:t.ADS_ALLOW_REJECT,reason:t.REJECT_REASON_SECTION}:{type:t.ADS_ALLOW_DISABLED}:{type:t.ADS_ALLOW_REJECT,reason:t.REJECT_REASON_UNKNOWN}},t.prototype._adsFetchAd=function(e,i,o,a,s){var r=this;this._loadAdman(function(n){if(!window.AdmanHTML)return r._adsSendAdEvent("no_adman",i,t.AD_TYPE,n),a&&a();var l={my:101,my_playlists:101,audio_feed:109,recent:113,user_wall:104,group_wall:104,user_list:102,group_list:103,user_playlists:102,group_playlists:103,feed:105,search:110,global_search:110,replies:104,im:106,group_status:104,user_status:104,recs:107,recs_audio:107,recs_album:107,other:114};r._adman=new AdmanHTML;var u={_SITEID:276,ver:251116,vk_id:vk.id,duration:e.duration,content_id:function(t,e){var i=t.toString(16),o=e.toString(16);for(;o.length<8;)o="0"+o;return i+o}(e.ownerId,e.id),vk_catid:l[i]||l.other};extend(u,e.ads||{}),nav.objLoc.preview&&(u.preview=intval(nav.objLoc.preview)),cur.adsPreview&&(u.preview=1),r._adman.setDebug(!!u.preview),r._adman.onError(function(){return a&&a()}),r._adman.onReady(function(){if(r._adman){var e=r._adman.getBannersForSection(t.AD_TYPE);e&&e.length?"statistics"==e[0].type?(r._adsPlayAd(!0,i),a&&a()):(r._adsSendAdEvent("received",i),o?(r._adsSendAdEvent("rejected",i,t.AD_TYPE,s),r._adsDeinit(),a&&a()):(r._adsSendAdEvent("ready",i),r.notify(t.EVENT_AD_READY),r._adsPlayAd(!1,i,a))):(o||r._adsSendAdEvent("not_received",i),a&&a())}}),r._adman.init({slot:3514,wrapper:se("<div></div>"),params:u,browser:{adBlock:!!window.abp,mobile:!1}}),r._adsSendAdEvent("requested",i)})},t.prototype._loadAdman=function(t){var e=this,i=function(e){return t&&t(e)};if(this._admanLoaded)return i();loadScript("//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",{onLoad:function(){e._admanLoaded=!0,i()},onError:function(){window.abp?(e._admanLoaded=!0,i()):(e._admanRetry=e._admanRetry?e._admanRetry+1:1,e._admanRetry>=3&&(e._admanLoaded=!0),i("script_load_fail"))}})},t.prototype._podcastUpdateState=function(e,i,o,a,s){var r=t._podcastGetStates(),n=Math.round(e.duration*i);r[e.fullId]={t:vkNow(),position:n},t._podcastSetStates(r),a&&this._podcastSendLogs(a,e,o,n,s)},t.prototype._podcastSendLogs=function(t,e,i,o,s){if(e&&t&&a.a.isPodcast(e)&&(!cur._podcastsActionId||!cur._podcastsActionId[t]||this._podcastsActionLastId[t]!==cur._podcastsActionId[t])){var r=this._podcastsActionRef[e.fullId]||{},n=r[t]||{};a.a.PodcastsLogs.log(t,extend({audio:e,position:o,listen:i},n,s||{})),delete r[t],this._podcastsActionLastId[t]=cur._podcastsActionId?cur._podcastsActionId[t]:null}},t.prototype.podcastSetActionRef=function(t,e,i,o){t=a.a.asObject(t),e&&a.a.isPodcast(t)&&(this._podcastsActionRef[t.fullId]=this._podcastsActionRef[t.fullId]||{},this._podcastsActionRef[t.fullId][e]={ref:i,refEl:o},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[e]=irand(0,1e6))},t.prototype._podcastCleanStates=function(){var e=t._podcastGetStates(),i=!1;return each(e,function(t,o){Date.now()-o.t>2419200&&(delete e[t],i=!0)}),i&&t._podcastSetStates(e),e},t.prototype._podcastSaveData=function(e){var i=t._podcastGetStates();each(e,function(t,e){var o=e.state;if(o){var a=+o[1];(!i[t]||!i[t][1]||a&&a>i[t][1])&&(i[t]={position:+o[0],t:Date.now()})}}),t._podcastSetStates(i)},t.prototype._podcastRestoreState=function(){var e=a.a.asObject(this.getCurrentAudio());if(!a.a.isPodcast(e))return 0;var i=0;cur.podcastSeekToTime?(i=this.seekToTime(cur.podcastSeekToTime,cur.podcastSeekToTimeRef),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef):(i=((t._podcastGetStates()[e.fullId]||{}).position||0)/e.duration)&&i<1&&this._implSeek(i);return i&&i<1?(this.updateCurrentPlaying(),i):0},t.prototype.getCurrentFaveStatus=function(){return!!a.a.isPodcast(this._currentAudio)&&a.a.getAudioExtra(this._currentAudio).fave},t.prototype._updatePlaybackRate=function(){var e=this;this._implNewTask("playback_rate",function(i){var o=!e._adsIsAdPlaying()&&a.a.isPodcast(e._currentAudio)?t.podcastGetPlaybackRate():1;e._impl.setPlaybackRate(o),i()})},t.prototype.podcastChangePlaybackRate=function(e){var i=t._lsGet(t.LS_PODCASTS)||{},o=i.rate||1;e?o-=t.PLAYBACK_RATE_STEP:o+=t.PLAYBACK_RATE_STEP,!e&&o>t.PLAYBACK_RATE_MAX?o=1:e&&o<1&&(o=t.PLAYBACK_RATE_MAX),i.rate=o,t._lsSet(t.LS_PODCASTS,i),this._updatePlaybackRate()},t.prototype.playAudio=function(t){var e=new AudioPlaylist(AudioPlaylist.TYPE_TEMP);e.mergeWith({list:[t]}),this.play(t,e)},t}();P.EVENT_CURRENT_CHANGED="curr",P.EVENT_PLAY="start",P.EVENT_PAUSE="pause",P.EVENT_STOP="stop",P.EVENT_UPDATE="update",P.EVENT_LOADED="loaded",P.EVENT_ENDED="ended",P.EVENT_FAILED="failed",P.EVENT_BUFFERED="buffered",P.EVENT_PROGRESS="progress",P.EVENT_VOLUME="volume",P.EVENT_PLAYLIST_CHANGED="plchange",P.EVENT_ADDED="added",P.EVENT_REMOVED="removed",P.EVENT_FREQ_UPDATE="freq",P.EVENT_SEEK="seek",P.EVENT_PLAY_NEXT="play_next",P.EVENT_AD_READY="ad_ready",P.EVENT_AD_DEINITED="ad_deinit",P.EVENT_AD_STARTED="ad_started",P.EVENT_AD_COMPLETED="ad_completed",P.EVENT_START_LOADING="start_load",P.EVENT_CAN_PLAY="actual_start",P.LS_VER="v20",P.LS_KEY_PREFIX="audio",P.LS_PREFIX=P.LS_KEY_PREFIX+"_"+P.LS_VER+"_",P.LS_VOLUME="vol",P.LS_PL="pl",P.LS_TRACK="track",P.LS_SAVED="saved",P.LS_PROGRESS="progress",P.LS_PODCASTS="podcasts",P.LS_DURATION_TYPE="dur_type",P.LS_UUID="uuid",P.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",P.PLAYBACK_RATE_STEP=.5,P.PLAYBACK_RATE_MAX=3,P.DEFAULT_VOLUME=.4761515102104643,P.AD_TYPE="preroll";var I=window.devicePixelRatio>=2?"_2x":"";function v(t,e,i){var o=t.getContext("2d");o.clearRect(0,0,t.width,t.height),o.fillStyle=i?"#3D6899":"#ffffff";for(var a=0;a<4;a++){var s=2+12*e[a];o.fillRect(13+4*a,12-s+14,2,s)}}function m(){window.AudioLayer=o.a,window.AudioUtils=a.a,window.TopAudioPlayer=r,window.AudioPlaylist=n.a,window.AudioPlayer=P}P.tabIcons={def:"/images/icons/favicons/fav_logo"+I+".ico",play:"/images/icons/favicons/fav_play"+I+".ico",pause:"/images/icons/favicons/fav_pause"+I+".ico"},P.ADS_ALLOW_DISABLED=1,P.ADS_ALLOW_ALLOWED=2,P.ADS_ALLOW_REJECT=3,P.REJECT_REASON_UNKNOWN="unknown",P.REJECT_REASON_LIMIT="track_limit_exceeded",P.REJECT_REASON_SECTION="section_not_allowed",i.d(e,"a",function(){return m})},D33C:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return AudioPlaylist});var _utils__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("pp2G"),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("PMB/");function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var AudioPlaylist=function(){function AudioPlaylist(t,e,i){_classCallCheck(this,AudioPlaylist),getAudioPlayer().addPlaylist(this);var o={};if(t&&isFunction(t.getId))return this._ref=t,void getAudioPlayer().addPlaylist(this);isObject(t)?o=t:(o.ownerId=e,o.type=t,o.albumId=i||++AudioPlaylist.plIndex),this._type=o.type,this._ownerId=o.ownerId||vk.id,this._albumId=o.albumId||0,this._fromId=o.fromId||0,this._list=[],this.mergeWith(o)}return AudioPlaylist.prototype.getId=function(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()},AudioPlaylist.prototype.getFullId=function(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")},AudioPlaylist.prototype.isReference=function(){return!!this._ref},AudioPlaylist.prototype.getSelf=function(){return this._ref&&isObject(this._ref)?this._ref:this},AudioPlaylist.prototype.getType=function(){return this.getSelf()._type},AudioPlaylist.prototype.getOwnerId=function(){return this.getSelf()._ownerId},AudioPlaylist.prototype.getAlbumId=function(){return this.getSelf()._albumId},AudioPlaylist.prototype.getPlaylistId=function(){return this.getSelf()._albumId},AudioPlaylist.prototype.getOriginalPlaylistRawId=function(){return this.getSelf()._originalPlaylistRawId},AudioPlaylist.prototype.getFollowHash=function(){return this.getSelf()._followHash},AudioPlaylist.prototype.getRawId=function(){return this.getSelf()._rawId},AudioPlaylist.prototype.getGridCovers=function(){return this.getSelf()._gridCovers||""},AudioPlaylist.prototype.getTitle=function(){return this.getSelf()._title||""},AudioPlaylist.prototype.getSubtitle=function(){return this.getSelf()._subTitle||""},AudioPlaylist.prototype.getDescription=function(){return this.getSelf()._description||""},AudioPlaylist.prototype.getRawDescription=function(){return this.getSelf()._rawDescription||""},AudioPlaylist.prototype.getAccessHash=function(){return this.getSelf()._accessHash||""},AudioPlaylist.prototype.getFromId=function(){return this.getSelf()._fromId||0},AudioPlaylist.prototype.getAuthorLine=function(){return this.getSelf()._authorLine||""},AudioPlaylist.prototype.getAuthorHref=function(){return this.getSelf()._authorHref||""},AudioPlaylist.prototype.getAuthorName=function(){return this.getSelf()._authorName||""},AudioPlaylist.prototype.getInfoLine1=function(){return this.getSelf()._infoLine1||""},AudioPlaylist.prototype.getInfoLine2=function(){return this.getSelf()._infoLine2||""},AudioPlaylist.prototype.getListens=function(){return this.getSelf()._listens||0},AudioPlaylist.prototype.getAddClasses=function(){return this.getSelf()._addClasses||""},AudioPlaylist.prototype.getLastUpdated=function(){return this.getSelf()._lastUpdated||""},AudioPlaylist.prototype.getEditHash=function(){return this.getSelf()._editHash||""},AudioPlaylist.prototype.getDeleteHash=function(){return this.getSelf()._deleteHash||""},AudioPlaylist.prototype.getReplaceHash=function(){return this.getSelf()._replaceHash||""},AudioPlaylist.prototype.getCoverUrl=function(){return this.getSelf()._coverUrl||""},AudioPlaylist.prototype.getBlocks=function(){return this.getSelf()._blocks||{}},AudioPlaylist.prototype.getFeedFrom=function(){return this.getSelf()._feedFrom},AudioPlaylist.prototype.getFeedOffset=function(){return this.getSelf()._feedOffset},AudioPlaylist.prototype.getSearchParams=function(){return this.getSelf()._searchParams||null},AudioPlaylist.prototype.getSearchQid=function(){return this.getSelf()._searchQid||null},AudioPlaylist.prototype.getLocalFoundCount=function(){return this.getSelf()._localFoundTotal||0},AudioPlaylist.prototype.getTotalCount=function(){return this.getSelf()._totalCount},AudioPlaylist.prototype.getTotalCountHash=function(){return this.getSelf()._totalCountHash},AudioPlaylist.prototype.getShuffle=function(){return this.getSelf()._shuffle},AudioPlaylist.prototype.getFriendId=function(){return this.getSelf()._friend},AudioPlaylist.prototype.getNextOffset=function(){var t=this.getSelf();return t._forceReload?(t._forceReload=!1,0):t._nextOffset||this.getAudiosCount()},AudioPlaylist.prototype.getAudiosList=function(){return this.getSelf()._list||[]},AudioPlaylist.prototype.getSortedAudiosList=function(){return this.getSelf()._sortedList||this.getAudiosList()||[]},AudioPlaylist.prototype.getUnshuffledAudiosList=function(){var t=this.getSelf();return t._originalList?t._originalList:t._list},AudioPlaylist.prototype.getItemsList=function(){return this.getSelf()._items||[]},AudioPlaylist.prototype.getPostId=function(){return this.getSelf()._postId},AudioPlaylist.prototype.getWallQuery=function(){return this.getSelf()._wallQuery},AudioPlaylist.prototype.getWallType=function(){return this.getSelf()._wallType},AudioPlaylist.prototype.getCommunititesBlock=function(){return this.getSelf()._communitiesBlock},AudioPlaylist.prototype.getArtistsBlock=function(){return this.getSelf()._artistsBlock},AudioPlaylist.prototype.getPlaylistsBlock=function(){return this.getSelf()._playlistsBlock},AudioPlaylist.prototype.getLiveInfo=function(){var t=this.getSelf()._live;return!!t&&{hostId:(t=t.split(","))[0],audioId:t[1],hash:t[2]}},AudioPlaylist.prototype.getAudioAt=function(t){return this.getSelf()._list.length>t?this.getSelf()._list[t]:null},AudioPlaylist.prototype.getAudiosCount=function(){return this.getSelf()._list.length},AudioPlaylist.prototype.getTotalDuration=function(){var t=this.getAudiosList(),e=0;return each(t,function(t,i){e+=i[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_DURATION]}),e},AudioPlaylist.prototype.getItemsCount=function(){var t=this.getSelf();return t._items=t._items||[],t._items.length},AudioPlaylist.prototype.setForceReload=function(t){this.getSelf()._forceReload=t},AudioPlaylist.prototype.setLocalFoundCount=function(t){this.getSelf()._localFoundTotal=t},AudioPlaylist.prototype.setAdsAllowed=function(t){return this.getSelf()._isAdsAllowed=t},AudioPlaylist.prototype.setFollowed=function(t){var e=this.getAddClasses()||"";return e=e.replace("audio_playlist__followed",""),t&&(e+=" audio_playlist__followed"),this.getSelf()._addClasses=e,this.getSelf()._isFollowed=t},AudioPlaylist.prototype.isBlocked=function(){return!!this.getSelf()._isBlocked},AudioPlaylist.prototype.hasMore=function(){return!!this.getSelf()._hasMore},AudioPlaylist.prototype.isOfficial=function(){return!!this.getSelf()._isOfficial},AudioPlaylist.prototype.isFollowed=function(){return this.getSelf()._isFollowed},AudioPlaylist.prototype.isShuffled=function(){return!!this.getShuffle()},AudioPlaylist.prototype.isAdsAllowed=function(){return!!this.getSelf()._isAdsAllowed},AudioPlaylist.prototype.isInitedSortedList=function(){return!!this.getSelf()._sorted},AudioPlaylist.prototype.isFullyLoadable=function(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST},AudioPlaylist.prototype.isLive=function(){return!!this.getLiveInfo()},AudioPlaylist.prototype._unref=function(){var t=this._ref;if(isObject(t)){var e={};for(var i in t)if(t.hasOwnProperty(i)&&!isFunction(t[i])&&0===i.indexOf("_")){var o=t[i];e[i.substr(1)]=isObject(o)?clone(o):o}e.hasMore=!1,delete e.ownerId,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._ownerId=e.ownerId||vk.id,this._albumId=AudioPlaylist.plIndex++,this._list=[],this.mergeWith(e)}},AudioPlaylist.prototype.equals=function(t){return this.getSelf()===t.getSelf()},AudioPlaylist.prototype.serialize=function(){var t={},e=getAudioPlayer().getCurrentAudio(),i=Math.max(0,this.indexOfAudio(e));return t.list=clone(this.getAudiosList().slice(Math.max(0,i-100),i+300),!0),each(t.list,function(t,e){e[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_URL]=""}),t.type=AudioPlaylist.TYPE_TEMP,t.ownerId=vk.id,t.albumId=irand(1,999),t.hasMore=!1,t.title=this.getTitle(),t.context=getAudioPlayer()._getPlayingContext(),t.originalPlaylistRawId=this.getOriginalPlaylistRawId(),this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(t.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),JSON.stringify(t)},AudioPlaylist.prototype.toString=function(){return this.getId()},AudioPlaylist.prototype._moveCurrentAudioAtFirstPosition=function(){var t=getAudioPlayer().getCurrentAudio(),e=this.getSelf(),i=this.indexOfAudio(t);-1!==i&&(e._list.splice(i,1),e._list.unshift(t),e._movedAudioToFirstPos=i)},AudioPlaylist.prototype._resetMovedAudioToInitialPosition=function(){var t=this.getSelf();if(t._movedAudioToFirstPos){var e=t._list.splice(0,1);t._list.splice(t._movedAudioToFirstPos,0,e[0]),delete t._movedAudioToFirstPos}},AudioPlaylist.prototype._ensureIndex=function(t){var e=this.getSelf();if(e._index)t&&t();else{var i=function(t,e){var i=intval(e);return i>=33&&i<48?String.fromCharCode(i):t};e._index=new vkIndexer(e._list,function(t){return(t[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_PERFORMER]+" "+t[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,i)},t)}},AudioPlaylist.prototype.clean=function(t){t||this._unref();var e=this.getSelf();e._hasMore=!0,e._list=[],e._items=[],e._feedOffset=e._feedFrom=0,e._nextOffset=0},AudioPlaylist.prototype.initSortedList=function(t){var e=this.getSelf();e._originalList||(e._originalList=[].concat(e._list)),e._sorted=!0,e._list=t},AudioPlaylist.prototype.removeSortedList=function(){var t=this.getSelf();t._originalList&&(t._list=[].concat(t._originalList)),t._sorted=!1},AudioPlaylist.prototype.shuffle=function(t){function e(e,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){if(!(this.isShuffled()&&t||!this.isShuffled()&&!t)){var i=this.getSelf();if(delete i._sorted,t){var o=!1;if(this.hasMore())if(this.getType()===AudioPlaylist.TYPE_SEARCH)i._originalList=i._originalList||[].concat(i._list),shuffle(i._list),e||this._moveCurrentAudioAtFirstPosition(),o=!0;else if(inArray(this.getType(),[AudioPlaylist.TYPE_RECOM])){var a=getAudioPlayer().getCurrentAudio(),s=this.indexOfAudio(a);this.clean(!0),s>=0&&i.addAudio(a,0),o=!0}else this._unref(),(i=this.getSelf())._originalList=i._originalList||[].concat(i._list),shuffle(i._list),e||this._moveCurrentAudioAtFirstPosition(),o=!0;else i._originalList=i._originalList||[].concat(i._list),shuffle(i._list),e||this._moveCurrentAudioAtFirstPosition(),o=!0;o&&(i._shuffle=t)}else i._originalList?i._list=i._originalList:this.clean(!0),delete i._shuffle,delete i._originalList;return!0}}),AudioPlaylist.prototype.getNextAudio=function(t,e){if(!t)return!!(t=this.getAudioAt(0))&&(e&&_utils__WEBPACK_IMPORTED_MODULE_0__.a.asObject(t).isClaimed?this.getNextAudio(t,!0):t);var i=this.indexOfAudio(t);if(i<0)return!1;if(i+1<this.getAudiosCount()){var o=this.getAudioAt(i+1);return e&&_utils__WEBPACK_IMPORTED_MODULE_0__.a.asObject(o).isClaimed?this.getNextAudio(o,!0):o}return!1},AudioPlaylist.prototype.removeAudio=function(t){var e=this.indexOfAudio(t);if(e>=0){this._unref();var i=this._list.splice(e,1);return this._index&&this._index.remove(i[0]),e}return-1},AudioPlaylist.prototype.addAudio=function(t,e){var i=this;this._unref();var o=void 0===e,a=function(t){var a=i.getUnshuffledAudiosList(),s=i.indexOfAudio(t);if(s>=0){if(o)return;a.splice(s,1)}(t=clone(t))[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_TITLE]=clean(replaceEntities(t[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),t[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_PERFORMER]=clean(replaceEntities(t[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,"")),o?a.push(t):a.splice(e,0,t),i._index&&i._index.add(t)};if(isArray(t)&&isArray(t[0]))for(var s=0,r=t.length;s<r;s++)a(t[s]);else t&&t.length&&a(t)},AudioPlaylist.prototype.moveAudio=function(t,e){this._unref();var i=this._list.splice(t,1);t<e&&(e-=1),this._list.splice(e,0,i[0])},AudioPlaylist.prototype.indexOfAudio=function(t){if(!t)return-1;var e=void 0;isString(t)?e=t.split("_"):isObject(t)?e=[t.ownerId,t.id]:isArray(t)&&(e=[t[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_OWNER_ID],t[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_ID]]);var i=this.getSelf()._list;if(!i)return-1;for(var o=0,a=i.length;o<a;o++)if(i[o]&&e[0]==i[o][_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==i[o][_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_ID])return o;return-1},AudioPlaylist.prototype.getAudio=function(t){if(!t)return null;var e=this.getSelf();t=t.split("_");for(var i=0,o=e._list.length;i<o;i++)if(t[0]==e._list[i][_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==e._list[i][_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_ID])return e._list[i];return null},AudioPlaylist.prototype.loadAll=function(t){if(!this.isFullyLoadable())return t&&t();this.load(0,t,!0)},AudioPlaylist.prototype.load=function load(offset,onDone,needAll){var _this2=this,trackType=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default";isFunction(offset)&&(onDone=offset,offset=0);var searchParams=this.getSearchParams();offset=intval(offset);var countAvailable=this.getType()===AudioPlaylist.TYPE_FEED?this.getItemsCount():this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore();if(offset<countAvailable&&!isGoingToLoadAll)return onDone&&onDone(this);var callOnDones=function(t,e){var i=_this2._onDoneLoading;delete _this2._onDoneLoading,delete _this2._loadingAll,each(i||[],function(t,i){i&&i(_this2,e)})};if(!this.hasMore())return onDone&&onDone(this);if(searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery)return onDone&&onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(onDone),!this._loadingAll){if(needAll)return this._loadingAll=!0,void Object(_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_1__.a)(this,callOnDones);offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout);var ownerId=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();ajax.post("al_audio.php",{act:"load_section",type:this.getType(),owner_id:ownerId,playlist_id:this.getPlaylistId(),offset:offset,access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?intval(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),shuffle:this.getShuffle(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:intval(nav.objLoc.claim),track_type:trackType},{onDone:function onDone(loadedPlaylist,tpl,langs,templatesScript){addTemplates({audio_playlist_snippet:tpl}),extend(cur.lang,langs),templatesScript&&eval(templatesScript),_this2._loadingAll&&!needAll||(getAudioPlayer().mergePlaylistData(_this2,loadedPlaylist),callOnDones(),getAudioPlayer().saveStateCurrentPlaylist(),offset||(clearTimeout(_this2._sendSearchStatsTimeout),_this2._sendSearchStatsTimeout=setTimeout(_this2.sendSearchStats.bind(_this2,"search_view"),3e3),_this2._searchPlayStatsSent=!1))}})}},AudioPlaylist.prototype.mergeWith=function(t){var e=this;if(!isObject(this._ref)){if(t.list&&this.addAudio(t.list),t.items){this._items=this._items||[];for(var i=0,o=t.items.length;i<o;i++)this._items.push(t.items[i])}each(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","originalList","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","shuffle","subTitle","title","totalCount","totalCountHash","wallQuery","wallType"],function(i,o){void 0!==t[o]&&(e["_"+o]=t[o])})}},AudioPlaylist.prototype.search=function(t,e){var i=this.getSelf();isObject(t)||(t={q:t}),this._ensureIndex(function(){var o=i._index?i._index.search(t.q):[];return o=o.filter(function(e){return!t.lyrics||!!intval(e[_utils__WEBPACK_IMPORTED_MODULE_0__.a.AUDIO_ITEM_INDEX_LYRICS])}),e(o)})},AudioPlaylist.prototype.sendSearchStats=function(t){if("search_play"==t){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:t,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})},AudioPlaylist.prototype.fetchNextLiveAudio=function(t){var e=this,i=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:i.hostId,hash:i.hash},{onDone:function(i){if(i){var o=e.indexOfAudio(i);o>=0?e.moveAudio(o,e.getAudiosCount()-1):e.addAudio(i)}t&&t(i)}})},AudioPlaylist}();AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_FEED="feed",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.DEFAULT_PLAYLIST_ID=-1},"PMB/":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return loadAllPlaylistAudios});var AUDIO_LOAD_CHUNK_SIZE=2e3;function loadAllPlaylistAudios(playlist,onDone){if(!playlist.hasMore()||!playlist.isFullyLoadable())return onDone&&onDone();var chunks=[],totalCount=playlist.getTotalCount(),isDeleted=!1,onAllLoaded=function(){if(isDeleted)return onDone&&onDone(null,isDeleted);var t=[];each(chunks,function(e,i){i&&(t=t.concat(i))}),each(getAudioPlayer().getPlaylists(),function(e,i){i.getId()===playlist.getId()&&(i._list=t)}),getAudioPlayer().mergePlaylistData(playlist,{hasMore:!1}),onDone&&onDone(playlist)},loadChunk=function loadChunk(chunkIndex,_cb){ajax.post("al_audio.php",{act:"load_section",type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset:chunkIndex*AUDIO_LOAD_CHUNK_SIZE,is_loading_all:1,claim:intval(nav.objLoc.claim)},{onDone:function onDone(data,tpl,langs,templatesScript){if(0===chunkIndex){if(addTemplates({audio_playlist_snippet:tpl}),extend(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,_cb();totalCount=data.totalCount,getAudioPlayer().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,_cb()}})},loadAllChunks=function(t,e){e=e||0;var i=Math.max(0,Math.ceil(totalCount/AUDIO_LOAD_CHUNK_SIZE));i-e<=0?t():function(){for(var o=new CallHub(t,i-e),a=e;a<i;a++)loadChunk(a,function(){o.done()})}()};void 0===totalCount?loadChunk(0,function(){isDeleted?onAllLoaded():loadAllChunks(onAllLoaded,1)}):loadAllChunks(onAllLoaded,0)}},pp2G:function(t,e,i){"use strict";var o={};i.r(o),i.d(o,"ACTION_PLAY",function(){return E}),i.d(o,"ACTION_PAUSE",function(){return P}),i.d(o,"ACTION_SEEK",function(){return I}),i.d(o,"ACTION_HEARTBEAT",function(){return v}),i.d(o,"ACTION_TIME_MARKER",function(){return m}),i.d(o,"log",function(){return O});var a={AUDIO_ITEM_INDEX_ID:0,AUDIO_ITEM_INDEX_OWNER_ID:1,AUDIO_ITEM_INDEX_URL:2,AUDIO_ITEM_INDEX_TITLE:3,AUDIO_ITEM_INDEX_PERFORMER:4,AUDIO_ITEM_INDEX_DURATION:5,AUDIO_ITEM_INDEX_ALBUM_ID:6,AUDIO_ITEM_INDEX_AUTHOR_LINK:8,AUDIO_ITEM_INDEX_LYRICS:9,AUDIO_ITEM_INDEX_FLAGS:10,AUDIO_ITEM_INDEX_CONTEXT:11,AUDIO_ITEM_INDEX_EXTRA:12,AUDIO_ITEM_INDEX_HASHES:13,AUDIO_ITEM_INDEX_COVER_URL:14,AUDIO_ITEM_INDEX_ADS:15,AUDIO_ITEM_INDEX_SUBTITLE:16,AUDIO_ITEM_INDEX_MAIN_ARTISTS:17,AUDIO_ITEM_INDEX_FEAT_ARTISTS:18,AUDIO_ITEM_INDEX_ALBUM:19,AUDIO_ITEM_INDEX_TRACK_CODE:20,AUDIO_ITEM_INDEX_RESTRICTION:21,AUDIO_ITEM_INDEX_ALBUM_PART:22,AUDIO_ITEM_INDEX_NEW_STATS:23,AUDIO_ITEM_ACCESS_KEY:24,AUDIO_ITEM_HAS_LYRICS_BIT:1,AUDIO_ITEM_CAN_ADD_BIT:2,AUDIO_ITEM_CLAIMED_BIT:4,AUDIO_ITEM_HQ_BIT:16,AUDIO_ITEM_LONG_PERFORMER_BIT:32,AUDIO_ITEM_UMA_BIT:128,AUDIO_ITEM_REPLACEABLE:512,AUDIO_ITEM_EXPLICIT_BIT:1024,AUDIO_ENOUGH_LOCAL_SEARCH_RESULTS:500,AUDIO_RECOMS_TYPE_LISTENED:"recoms6",AUDIO_PLAYING_CLS:"audio_row__playing",AUDIO_CURRENT_CLS:"audio_row__current",AUDIO_DURATION_CLS:"audio_row__duration",AUDIO_LAYER_HEIGHT:550,AUDIO_LAYER_MIN_WIDTH:400,AUDIO_LAYER_MAX_WIDTH:1e3,AUDIO_HQ_LABEL_CLS:"audio_hq_label_show",AUDIO_MAX_AUDIOS_IN_SNIPPET:5,AUDIO_ROW_COVER_SIZE:40,AUDIO_ROW_PLAY_SIZE:24,AUDIO_ROW_ACTION_ROW_ITEM:'<div role="button" class="audio_row__more_action audio_row__more_action_%0% _audio_row__more_action_%0% %3%">%2%</div>',LOG_LS_KEY:"audiolog"};var s=i("zxIV");var r=i("4bNW");var n=i("t7n3");var l=i("Egk5");var u=[];function d(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i="";if(e=!AudioUtils.isPodcast(t)&&e,isArray(t[AudioUtils.AUDIO_ITEM_INDEX_MAIN_ARTISTS])&&(i=AudioUtils.getAudioArtistsString(t[AudioUtils.AUDIO_ITEM_INDEX_MAIN_ARTISTS],e)),isArray(t[AudioUtils.AUDIO_ITEM_INDEX_FEAT_ARTISTS])&&(i+=" feat. ",i+=AudioUtils.getAudioArtistsString(t[AudioUtils.AUDIO_ITEM_INDEX_FEAT_ARTISTS],e)),!i){var o=t[AudioUtils.AUDIO_ITEM_INDEX_PERFORMER].replace(/<\/?em>/g,"");if(e)i='<a class="artist_link" data-performer="'+o+'" href="'+("/audio?performer=1&q="+encodeURIComponent(o))+'">'+o+"</a>";else i=o}return i}var _=600,c=3600,p=36e3;function h(t){return t<_?"s":t<c?"m":t<p?"l":"n"}function f(t,e){for(var i=JSON.parse(getTemplate("audio_bits_to_cls")),o=t[AudioUtils.AUDIO_ITEM_INDEX_FLAGS],a=[],s=0;s<32;s++){var r=1<<s;o&r&&a.push(i[r])}AudioUtils.isPodcast(t)&&(a.push("audio_podcast"),AudioUtils.isPrivatePodcast(t)&&a.push("audio_podcast_private")),e&&a.push(e);var n="";if(t[AudioUtils.AUDIO_ITEM_INDEX_COVER_URL]){var l=t[AudioUtils.AUDIO_ITEM_INDEX_COVER_URL].split(",");n="background-image: url("+l[0]+")"}var u=AudioUtils.getAudioPerformers(t),d=t[AudioUtils.AUDIO_ITEM_INDEX_DURATION],_=formatTime(d),c=clean(JSON.stringify(t)),p=getTemplate("audio_row",t);return p=(p=(p=(p=(p=(p=p.replace(/%cls%/,function(){return a.join(" ")})).replace(/%duration%/,function(){return _})).replace(/%serialized%/,function(){return c})).replace(/%cover_style%/,function(){return n})).replace(/%performers%/,function(){return u})).replace(/%duration_mod%/,function(){return h(d)})}var A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function y(t){if(!t)return null;if(isObject(t))return t;if("string"==typeof t)return{id:t};var e=(t[a.AUDIO_ITEM_INDEX_HASHES]||"").split("/"),i=(t[a.AUDIO_ITEM_INDEX_COVER_URL]||"").split(","),o=d(t,!1);return{id:intval(t[a.AUDIO_ITEM_INDEX_ID]),owner_id:intval(t[a.AUDIO_ITEM_INDEX_OWNER_ID]),ownerId:t[a.AUDIO_ITEM_INDEX_OWNER_ID],fullId:t[a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[a.AUDIO_ITEM_INDEX_ID],title:t[a.AUDIO_ITEM_INDEX_TITLE],subTitle:t[a.AUDIO_ITEM_INDEX_SUBTITLE],performer:o,duration:intval(t[a.AUDIO_ITEM_INDEX_DURATION]),lyrics:intval(t[a.AUDIO_ITEM_INDEX_LYRICS]),url:t[a.AUDIO_ITEM_INDEX_URL],flags:t[a.AUDIO_ITEM_INDEX_FLAGS],context:t[a.AUDIO_ITEM_INDEX_CONTEXT],extra:t[a.AUDIO_ITEM_INDEX_EXTRA],accessKey:t[a.AUDIO_ITEM_ACCESS_KEY],addHash:e[0]||"",editHash:e[1]||"",actionHash:e[2]||"",deleteHash:e[3]||"",replaceHash:e[4]||"",urlHash:e[5]||"",restoreHash:e[6]||"",canEdit:!!e[1],canDelete:!!e[3],isLongPerformer:t[a.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_ITEM_LONG_PERFORMER_BIT,canAdd:!!(t[a.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_ITEM_CAN_ADD_BIT),coverUrl_s:i[0],coverUrl_p:i[1],isClaimed:!!(t[a.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_ITEM_CLAIMED_BIT),isExplicit:!!(t[a.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_ITEM_EXPLICIT_BIT),isUMA:!!(t[a.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_ITEM_UMA_BIT),isReplaceable:!!(t[a.AUDIO_ITEM_INDEX_FLAGS]&a.AUDIO_ITEM_REPLACEABLE),ads:t[a.AUDIO_ITEM_INDEX_ADS],album:t[a.AUDIO_ITEM_INDEX_ALBUM],albumId:intval(t[a.AUDIO_ITEM_INDEX_ALBUM_ID]),albumPart:intval(t[a.AUDIO_ITEM_INDEX_ALBUM_PART]),trackCode:t[a.AUDIO_ITEM_INDEX_TRACK_CODE],restrictionStatus:t[a.AUDIO_ITEM_INDEX_RESTRICTION],useNewStats:Boolean(t[a.AUDIO_ITEM_INDEX_NEW_STATS])}}var g=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],o=!0,a=!1,s=void 0;try{for(var r,n=t[Symbol.iterator]();!(o=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){a=!0,s=t}finally{try{!o&&n.return&&n.return()}finally{if(a)throw s}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var E="play",P="pause",I="seek",v="heartbeat",m="time_marker";function O(t,e){var i=e.audio;AudioUtils.isPodcast(i)&&stManager.add([jsc("web/podcast.js")],function(){Podcast.log(t,e)})}var T=i("RbYe");var b=25e3,w=null,D=null,L=null;function S(t){window.Notifier&&w!==t.key&&(L&&clearTimeout(L),w=t.key,Notifier.addKey({key:t.key,ts:t.timestamp},function(e,i){return function(t,e){if(t===w)if(e.failed)C(!0);else for(var i=getAudioPlayer(),o=i.isPlaying(),a=i.getCurrentAudio(),s=AudioUtils.isPodcast(a),r=0;r<e.events.length;r++){var n=e.events[r].data;if("start"===n.type&&AudioPlayer.getDeviceId()!==n.uuid&&!D&&!s&&o){i.pausedByQueue=vkNow(),i.pause(),D=showBox("al_audio.php",{act:"start_playback_box",uuid:n.uuid,device_name:n.device_name},{params:{hideButtons:!0,onHide:function(){D=!1}},containerClass:"audio_playback_box"});break}}}(t.key,i)}),L=setTimeout(function(){return C(!0)},b))}function C(t){var e=getAudioPlayer().getCurrentAudio(),i=window.Notifier&&e&&!vk.widget,o=!t&&w,a=AudioUtils.isPodcast(e);!i||a||o||e&&(e=AudioUtils.asObject(e),ajax.post("al_audio.php",{act:"queue_params",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{onDone:function(t){if(t&&t.errors&&!t.errors.length){var e=t.data.queues[0];e&&S(e)}}}))}var U=i("aong"),N=i("/PiP"),R=i("EasH"),k=i("XzvV");function M(t){Object(R.d)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:function(){Object(k.d)("audio_restriction_popup","hide",t.restrictionStatus)}},'\n    <button class="audio_restriction_box__close" onclick="curBox().hide()">'+getLang("global_close")+'</button>\n    <div class="audio_restriction_box__icon audio_restriction_box__icon_pensive_face"></div>\n    <div class="audio_restriction_box__title">'+getLang("audio_restriction_title_claim")+'</div>\n    <div class="audio_restriction_box__controls">\n        <button class="flat_button" onclick="curBox().hide()">'+getLang("global_close")+"</button>\n    </div>\n  ")}i.d(e,"a",function(){return j});var j=(Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t})({},a,{audioSearchPerformer:function(t,e,i){var o=!!window.AudioPage&&currentAudioPage(t),a=window.AudioPage&&currentAudioPage(t)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout(function(){o&&a?(e=unclean(e).replace(/<em>|<\/em>/g,""),nav.change({q:e,performer:1},i,{searchPerformer:!0,nav:!0,isLayer:o.isLayer()})):nav.go(t,i)},50)},toggleAudioLyrics:function(t,e){var i=Object(s.H)("_audio_row__lyrics",t);if(i)if(Object(s.ub)(i)){var o=Object(s.N)(t)[1],a=Object(s.N)(i)[1];Object(s.qb)(t,"height",o+a),Object(s.i)(t,"prevHeight",o)}else{var r=Object(s.i)(t,"prevHeight");Object(s.qb)(t,"height",r)}else{Object(s.a)(t,"audio_loading");var n={act:"get_lyrics",aid:e.fullId,lid:e.lyrics};AudioUtils.isPodcast(e)&&(n.podcast=!0),ajax.post("al_audio.php",n,{onDone:function(o){Object(s.hb)(t,"audio_loading"),i=Object(s.mb)('<div class="_audio_row__lyrics audio_row__lyrics" data-nodrag="1" style="display:none;"><div class="audio_row__lyrics_inner">'+o+"</div></div>"),Object(s.H)("_audio_row_content",t).appendChild(i),AudioUtils.toggleAudioLyrics(t,e)}})}},getRowActionName:function(t,e,i){var o=void 0,a=AudioUtils.getAddRestoreInfo();switch(t){case"current_delete":o=getLang("audio_delete_from_current");break;case"recoms_delete":o=getLang("audio_dont_show");break;case"listened_delete":o=getLang("audio_remove_from_list");break;case"delete":if(AudioUtils.isPodcast(e))o=getLang("audio_podcast_delete_episode");else if(window.AudioPage&&AudioPage.isInRecentPlayed(i))o=getLang("audio_remove_from_list");else{var s=a[e.fullId];o=s&&s.deleteAll?s.deleteAll.text:getLang("global_delete_audio")}break;case"restore_recoms":o=getLang("audio_restore_audio");break;case"add":var r=a[e.fullId];if(AudioUtils.isPodcast(e))o=getLang("audio_podcast_restore_episode");else if(r&&"deleted"==r.state)o=getLang("audio_restore_audio");else if(r&&"added"==r.state)o=getLang("global_delete_audio");else{var n=!!window.AudioPage&&currentAudioPage(i);o=n&&n.getOwnerId()<0&&n.canAddToGroup()?getLang("audio_add_to_group"):getLang("audio_add_to_audio")}break;case"edit":o=AudioUtils.isPodcast(e)?getLang("audio_podcast_edit_episode"):getLang("audio_edit_audio");break;case"next":o=cur.lang&&cur.lang.global_audio_set_next_audio||getLang("audio_set_next_audio");break;case"recoms":o=getLang("audio_show_recommendations");break;case"fave":o=AudioUtils.isPodcast(e)?getLang("audio_podcast_listen_later"):"";break;default:o=""}return o},initRowPlaylistsChooser:function(t,e,i){var o=AudioUtils.asObject(t),a=void 0;a=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,AudioUtils.playlistsByAudioDataCache=AudioUtils.playlistsByAudioDataCache||{};var s=AudioUtils.playlistsByAudioDataCache,r=a+"_"+o.ownerId+"_"+o.id;s[r]?AudioUtils._showPlaylistsChooser(i,e,s[r],a,o,t):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:a,audio_owner_id:o.ownerId,audio_id:o.id},{onDone:function(n,l,u){var d=s[r]={playlists:n,morePlaylists:l,newPlaylistHash:u};AudioUtils._showPlaylistsChooser(i,e,d,a,o,t)}})},addToPlaylistsBoxInit:function t(e,i,o,a,r){if("undefined"==typeof AutoList)return stManager.add("auto_list.js",function(){t(e,i,o,a,r)});var n=curBox(),l=Object(s.H)("_audio_atp_content",n.bodyNode),u=Object(s.H)("_audio_atp_list",n.bodyNode),d=Object(s.F)("audio_atp_search"),_=Object(s.H)("_audio_atp_empty"),c=Object(s.N)(l)[1];Object(s.qb)(u,{height:c-Object(s.N)(d)[1]});var p="",h=void 0;function f(){h&&h.destroy(),u.innerHTML="";var t=[];t=p?a.filter(function(t){return t[2].toLowerCase().indexOf(p)>=0}):a,Object(s.ub)(u,0!=t.length),Object(s.ub)(_,0==t.length),h=new AutoList(u,{onNeedRows:function(e,i){for(var o=[],a=i,s=Math.min(t.length,i+30),r=a;r<s;r++){var n=t[r];if(n){var l='<div class="ape_pl_item _ape_pl_item '+(n[4]?"ape_selected":"")+'" data-id="'+n[1]+'"><div class="ape_check"><div class="ape_check_icon"></div></div><div class="ape_pl_item_inner"><span class="ape_pl_title">'+n[2]+'</span> <span class="ape_pl_size">'+n[3]+"</span></div></div>";o.push(l)}}e(o)}})}f(),cur.addToPlaylistSearch=debounce(function(t){p=trim(t).toLowerCase(),f()},200);var A={},y={};addEvent(u,"click",function(t){var e=Object(s.n)("_ape_pl_item",t.target),i=Object(s.s)(e,"id");Object(s.vb)(e,"ape_selected")?(y[i]=!0,delete A[i]):(A[i]=!0,delete y[i])}),n.removeButtons(),n.addButton(getLang("global_save"),function(t){var a=Object.keys(y),s=Object.keys(A);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:a.join(","),remove_pl_ids:s.join(","),owner_id:e,audio_owner_id:i,audio_id:o,hash:r},{showProgress:lockButton.pbind(t),hideProgress:unlockButton.pbind(t),onDone:function(){n.hide()}})},"ok",!0),n.addButton(getLang("global_cancel"),n.hide.bind(this),"no",!0)},showRecoms:function(t,e){cur.audioPage&&cur.audioPage.showRecoms(!1,e.fullId)},shareAudio:function(t,e){if(cur.viewAsBox)return cur.viewAsBox();if(e=e||getAudioPlayer().getCurrentAudio()){e=AudioUtils.asObject(e);var i=AudioUtils.isPodcast(e)?"podcast":"audio";return!showBox("like.php",{act:"publish_box",object:i+e.fullId,list:e.actionHash,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css","sharebox.js"],onFail:function(t){return showDoneBox(t),!0}})}},showAudioAlbum:function(t,e){if(cur.viewAsBox)return cur.viewAsBox();e=AudioUtils.asObject(e),layers.fullhide&&layers.fullhide(),AudioUtils.showAudioPlaylist(e.album[0],e.album[1],e.album[2])},openEpisode:function(t,e){e=AudioUtils.asObject(e),AudioUtils.isPodcast(e)&&showPodcast(t,e.fullId,null,"audio")},replaceWithOriginal:function(t,e,i){(e=e||getAudioPlayer().getCurrentAudio())&&(e=AudioUtils.asObject(e),ajax.post("al_audio.php",{act:"replace_with_original",hash:e.replaceHash,audio_id:e.fullId},{onDone:function(o){var a=JSON.parse(e.extra).claim.original;a[AudioUtils.AUDIO_ITEM_INDEX_ID]=o,a[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]=e.ownerId;var r=Object(s.mb)(AudioUtils.drawAudio(a));t.parentElement.insertBefore(r,t),t.parentElement.removeChild(t),i&&i()},onFail:i}))},editAudio:function(t,e,i){showBox("al_audio.php",{act:"edit_audio_box",aid:e.fullId,force_edit_hash:i},{params:{width:"456px",bodyStyle:"padding: 20px; background-color: #F7F7F7;",hideButtons:1},dark:1})},editEpisode:function(t,e){AudioUtils.isPodcast(e)&&(cur.podcastEditData={audioId:e.fullId},stManager.add([jsc("web/podcast.js")],function(){Podcast.edit(e.fullId)}))},deleteCurrentAudio:function(t,e){var i=getAudioPlayer().getCurrentPlaylist();i&&i.removeAudio(e.fullId),Object(s.fb)(t)},deleteRecomsAudio:function(t,e){AudioUtils.deleteAudio(t,e,!1,!0)},deleteListenedAudio:function(t,e){AudioUtils.deleteAudio(t,e,!1,!1,!0)},deleteAudio:function(t,e,i,o,a){function r(e){return Object(s.s)(t,"in-progress",Object(n.r)(e))}if(window.tooltips&&tooltips.hideAll(),!Object(n.r)(Object(s.s)(t,"in-progress"))){r(!0);var l=!1;e.isClaimed&&(l=!0);var u=AudioUtils.getAddRestoreInfo(),d=u[e.fullId];if(d&&d.deleteAll)showFastBox({title:getLang("audio_delete_all_title"),dark:1},d.deleteConfirmMsg||"",getLang("global_delete"),function(t){var e=extend({act:"delete_all"},d.deleteAll);ajax.post("al_audio.php",e,{showProgress:lockButton.pbind(t),onDone:function(){var t=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,d.deleteAll.from_id,AudioPlaylist.DEFAULT_PLAYLIST_ID);getAudioPlayer().deletePlaylist(t),nav.reload()}})},getLang("global_cancel"));else{if(l?Object(s.fb)(t):Object(s.a)(t,"audio_row__deleted"),a){ajax.post("al_audio.php",{act:"remove_listened",audio_id:e.id,audio_owner_id:e.ownerId,hash:e.actionHash}),Object(s.fb)(t);var _=getAudioPlayer().getCurrentPlaylist();_&&_.getType()==AudioPlaylist.TYPE_RECOM&&_.getAlbumId()==AudioUtils.AUDIO_RECOMS_TYPE_LISTENED&&_.removeAudio(e.fullId)}else if(o){var c={act:"hide_recommendation",hash:AudioUtils.getAudioExtra(e).recom.hash,audio_id:e.fullId};nav.objLoc.audio_id&&(c.recommendation_type="query"),ajax.post("al_audio.php",c,{onDone:function(){r(!1)}}),u[e.fullId]={state:"recom_hidden"};var p=getAudioPlayer().getCurrentPlaylist();p&&p.getType()==AudioPlaylist.TYPE_RECOM&&(u[e.fullId].removedCurrentPos=p.removeAudio(e))}else ajax.post("al_audio.php",{act:"delete_audio",oid:e.ownerId,aid:e.id,hash:e.deleteHash,restore:1,track_code:e.trackCode},{onDone:function(i,o){l||r(!1),u[e.fullId]={state:"deleted",deleteAll:i,deleteConfirmMsg:o},l&&AudioUtils.deleteDeletedAudios(),AudioUtils.onRowOver(t,!1,!0)}});AudioUtils.onRowOver(t,!1,!0)}}},deleteEpisode:function(t,e){AudioUtils.isPodcast(e)&&stManager.add([jsc("web/podcast.js")],function(){Podcast.deleteEpisode(e.fullId,e.deleteHash)})},restoreEpisode:function(t,e){AudioUtils.isPodcast(e)&&stManager.add([jsc("web/podcast.js")],function(){Podcast.restoreEpisode(e.fullId,e.editHash)})},deleteDeletedAudios:function(){each(AudioUtils._audioAddRestoreInfo||{},function(t,e){"deleted"!=e.state&&"recom_hidden"!=e.state||getAudioPlayer().deleteAudioFromAllPlaylists(t)})},faveEpisode:function(t,e){if(AudioUtils.isPodcast(e)){var i=AudioUtils.getAudioExtra(e).faveHash;bookmarkPodcast(Object(s.H)("audio_row__action_fave",t),e.fullId,i)}},contextSplit:function(t){return isObject(t)&&(t=t.context),(t||"").split(":")},showAudioPlaylist:function(t,e,i,o,a,r){if(cur.apLayer)return cancelEvent(a);if(vk.widget)return!0;if(!a||!(a.metaKey&&browser.mac||a.ctrlKey)){var n=null;return window.Photoview&&window.cur&&cur.pvShown&&(n=clone(nav.objLoc),Photoview.hide(!0)),boxRefreshCoords(boxLoader),Object(s.tb)(boxLoader),Object(s.tb)(boxLayerWrap),stManager.add(["auto_list.js","audio.css"],function(){new AudioPlaylist({type:AudioPlaylist.TYPE_PLAYLIST,ownerId:t,albumId:e,hasMore:!0,accessHash:i,fromId:cur.oid}).loadAll(function(d,_){if(Object(s.W)(boxLoader),Object(s.W)(boxLayerWrap),_){var c=getLang("audio_error_deleted_playlist_box").split("/");return new MessageBox({title:c[0]}).content(c[1]).setButtons(getLang("global_close"),function(){curBox().hide(),n&&nav.change(n)}).show(),void nav.setLoc(extend(nav.objLoc,{z:!1}))}var p=extend(nav.objLoc,{z:"audio_playlist"+t+"_"+e+(i?"/"+i:"")});nav.setLoc(p),window.audioPlaylistLayerWrap||(window.audioPlaylistLayerWrap=Object(s.mb)('<div class="ap_layer_wrap"></div>'),bodyNode.appendChild(window.audioPlaylistLayerWrap)),window.audioPlaylistLayerWrap.innerHTML="";var h=d.getAudiosList().length,f=d.isBlocked&&d.isBlocked(),A=getTemplate("audio_playlist_snippet",{title:d.getTitle(),subTitle:d.getSubtitle(),description:d.getDescription(),coverStyle:d.getCoverUrl()?"background-image:url('"+d.getCoverUrl()+"'); background-size: cover;":"",authorLine:d.getAuthorLine(),infoLine1:d.getInfoLine1(),infoLine2:d.getInfoLine2(),id:d.getPlaylistId(),ownerId:d.getOwnerId(),href:"/audio?z=audio_playlist"+d.getOwnerId()+"_"+d.getPlaylistId()+"/"+d.getAccessHash(),addCls:d.getAddClasses(),followHash:d.getFollowHash(),accessHash:d.getAccessHash(),editHash:d.getEditHash(),deleteHash:d.getDeleteHash(),replaceHash:d.getReplaceHash(),gridCovers:d.getGridCovers(),type:d.getType(),context:o,followButtonText:d.isFollowed()?getLang("audio_playlist_btn_added"):getLang("audio_playlist_btn_add")});if(cur.apLayer=Object(s.mb)('\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            '+A+'\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      '),f){var y=Object(s.H)("audio_pl_snippet__body",cur.apLayer);y.innerHTML=getTemplate("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),addEvent(window.audioPlaylistLayerWrap,"click",a=function(t){t.target!=window.audioPlaylistLayerWrap&&t.target!=Object(s.H)("_ap_layer__close",cur.apLayer)||layers.fullhide()}),addEvent(bodyNode,"keydown",l=function(t){if(27==t.keyCode)return layers.fullhide(),cancelEvent(t)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),Object(s.a)(layerBG,"ap_layer_bg_dark");var g=Object(s.H)("_audio_pl_snippet__list",cur.apLayer),E=AudioUtils.getAlbumParts(d),P=0;h&&!f&&(cur.apLayerAutoList=new AutoList(g,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(t,e){for(var i=[],o=d.getUnshuffledAudiosList(),a=e-=P;a<e+30;a++){var s=o[a];if(!s)break;if(E&&E.length&&E[0].offset===a){var r=E.shift();P++,i.push(AudioUtils.drawAlbumPartRow(r.number))}i.push(AudioUtils.drawAudio(s))}t(i)}})),boxRefreshCoords(cur.apLayer),getAudioPlayer().updateCurrentPlaying(),layers.fullhide=u,cur.apLayerPlaylistId=[t,e],r&&r()});var a=void 0,l=void 0;function u(t){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,a&&removeEvent(window.audioPlaylistLayerWrap,"click",a),l&&removeEvent(bodyNode,"keydown",l),delete cur.apLayer,delete cur.apLayerPlaylistId,Object(s.hb)(layerBG,"ap_layer_bg_dark"),n?nav.change(n):nav.change({z:!1}),layerQueue.pop()}}),!1}},editPlaylist:function(t,e,i,o){stManager.add(["audio.js","audio.css","auto_list.js"],function(){ajax.post("al_audio.php",{act:"playlists_edit_data",owner_id:t},{onDone:function(a){a.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[t]=a.audio_playlist_cover_upload_options),AudioPage.editPlaylist(t,e,i,o)}})})},followPlaylist:function(t,e,i,o){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function r(o){var a=Object(s.s)(t,"text-followed"),r=Object(s.s)(t,"text-follow");Object(s.s)(t,"tooltip-text",o?a:r),t.innerHTML=o?a:r,_.setFollowed(o);var n=_.getAddClasses()||"";n=n.replace("audio_pl__followed",""),o&&(n+=" audio_pl__followed"),_.mergeWith({addClasses:n}),each(Object(s.G)("_audio_pl_"+e+"_"+i),function(e,i){Object(s.vb)(i,"audio_pl__followed",o);var a=i.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];a&&(a.innerHTML=t.innerHTML)})}function n(t){if(cur.audioPage&&cur.audioPage.updatePlaylistsCounter&&"playlists"===cur.audioPage._currentSection){if(t){var o=null;u=u.filter(function(t){var a=t.playlistId===i&&t.playlistOwnerId===e;return a&&(o=t.pl),!a}),o&&cur.audioPage._data.playlists.push(o)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter(function(t){var o=t.id===i&&t.owner_id===e;return o&&u.push({playlistId:i,playlistOwnerId:e,pl:t}),!o});cur.audioPage.updatePlaylistsCounter&&cur.audioPage.updatePlaylistsCounter(vk.id)}}var l=Object(s.T)("_audio_pl",t),d=Object(s.vb)(l,"audio_pl__followed"),_=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,i);r(d),n(d),ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:e,playlist_id:i,hash:o,showcase:a},{onFail:function(t){return new MessageBox({title:getLang("global_error")}).content(t).setButtons("Ok",function(){curBox().hide()}).show(),r(!1),n(!1),!0}})},getLayer:function(){var t=window.audioLayer;return t||(window.audioLayer=t=new AudioLayer),t},updateQueueReceivedPost:function(t){t&&each(Object(s.G)("_audio_row",t),function(){Object(s.s)(this,"new-post","groups"==cur.module?"wall":"feed")})},toggleAudioHQBodyClass:function(){var t=AudioPlayer.showHQLabel();Object(s.vb)(document.body,AudioUtils.AUDIO_HQ_LABEL_CLS,t)},hasAudioHQBodyClass:function(){return Object(s.V)(document.body,AudioUtils.AUDIO_HQ_LABEL_CLS)},showNeedFlashBox:function(){var t=getLang("global_audio_flash_required").replace("{link}",'<a target=_blank href="https://get.adobe.com/flashplayer">').replace("{/link}","</a>");new MessageBox({title:getLang("audio_need_flash_title")}).content(t).setButtons("Ok",function(){curBox().hide()}).show()},getAddRestoreInfo:function(){return AudioUtils._audioAddRestoreInfo=AudioUtils._audioAddRestoreInfo||{},AudioUtils._audioAddRestoreInfo},addAudio:function(t,e){if(cur.viewAsBox)return cur.viewAsBox();if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function i(e){return Object(s.s)(t,"in-progress",Object(n.r)(e))}if(!Object(n.r)(Object(s.s)(t,"in-progress"))){i(!0),e||(e=AudioUtils.getAudioFromEl(t,!0));var o=window.AudioPage&&currentAudioPage(t),a=o&&o.getOwnerId()<0&&o.canAddToGroup()?-o.getOwnerId():0,r=AudioUtils.getAddRestoreInfo(),l=r[e.fullId],u=Object(s.H)("_audio_row_"+e.fullId);u=u!=t&&u;var d=o&&o.getPageCurrentPlaylist(),_=void 0,c=AudioUtils.getContextPlaylist(t,!0);c&&(_=(c=AudioUtils.contextSplit(c))[0]),("search"==_&&d&&d.getSearchQid()||"search"==cur.module&&cur.qid)&&(_="search:external");var p={act:"add",group_id:a,audio_owner_id:e.ownerId,audio_id:e.id,hash:e.addHash,from:_||"",track_code:e.trackCode};l?"recom_hidden"==l.state?(o&&(o.restoreRecommendation(t),i(!1)),AudioUtils.onRowOver(t,!1,!0)):"deleted"==l.state?(ajax.post("al_audio.php",{act:"restore_audio",oid:e.ownerId,aid:e.id,hash:e.restoreHash,track_code:e.trackCode},{onDone:function(){i(!1)}}),Object(s.hb)(t,"audio_row__deleted"),delete r[e.fullId],AudioUtils.onRowOver(t,!1,!0)):"added"==l.state&&(ajax.post("al_audio.php",{act:"delete_audio",oid:l.audio.ownerId,aid:l.audio.id,hash:l.audio.deleteHash,track_code:e.trackCode},{onDone:function(){var t=window.getAudioPlayer&&window.getAudioPlayer();t&&t.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,a?-a:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(l.addedFullId),i(!1)}}),Object(s.hb)(t,"audio_row__added"),u&&Object(s.hb)(u,"audio_row__added"),delete r[e.fullId],getAudioPlayer().notify(AudioPlayer.EVENT_REMOVED,e.fullId,l.addedFullId)):(ajax.post("al_audio.php",p,{onDone:function(t){if(t){var o=t[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[AudioUtils.AUDIO_ITEM_INDEX_ID];r[e.fullId]={state:"added",addedFullId:o,audio:AudioUtils.asObject(t)},getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,a?-a:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).addAudio(t,0),d&&d.getType()==AudioPlaylist.TYPE_SEARCH&&d.sendSearchStats("search_add")}i(!1)},onFail:function(e){return e&&new MessageBox({title:getLang("global_error")}).content(e).setButtons(getLang("global_close"),function(){return curBox().hide()}).show(),Object(s.hb)(t,"audio_row__added"),i(!1),!0}}),Object(s.a)(t,"audio_row__added"),u&&Object(s.a)(u,"audio_row__added"),getAudioPlayer().notify(AudioPlayer.EVENT_ADDED,e.fullId),o&&d&&o.onUserAction(e,d))}},addAudioToOwner:function(t,e){return window.onAudioPageLoaded=function(){return this.uploadAudio({})},nav.go("audios"+t),cancelEvent(e)},chooseAudioBox:function(t,e,i){if(void 0!==t.selected)cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,Object(s.hb)(Object(s.z)(t),"audio_selected"),t.innerHTML=e.labels.add;else{var o=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",e.owner_id+"_"+e.id,e.info),(!cur.attachCount||cur.attachCount()>o)&&cur.lastAddMedia&&(t.selected=cur.lastAddMedia.chosenMedias.length-1,Object(s.a)(Object(s.z)(t),"audio_selected"),t.innerHTML=e.labels.cancel)}return Object(l.c)(i)},getAudioArtistsString:function(t,e){var i="";return t.forEach(function(o,a){var s="/audio?performer=1&q="+encodeURIComponent(o.name),r=window.getWebHost?window.getWebHost():"";o.id&&(s="/artist/"+o.id),i+=e?'<a class="artist_link" href="'+r+s+'">'+o.name+"</a>":o.name,a<t.length-1&&(i+=", ")}),i},getAudioPerformers:d,drawAudio:f,isClaimedAudio:function(t){return!!t&&(t=AudioUtils.asObject(t)).flags&AudioUtils.AUDIO_ITEM_CLAIMED_BIT},getDurationMod:h,getAudioExtra:function(t){return t=AudioUtils.asObject(t),"object"===A(t.extra)?t.extra:JSON.parse(t.extra||"{}")},getAudioFromEl:function(t,e){t=Object(s.n)("_audio_row",t);var i=Object(s.i)(t,"audio");return i||(i=JSON.parse(Object(s.s)(t,"audio"))),e&&((i=AudioUtils.asObject(i)).isDeleted=Object(s.V)(t,"audio_row__deleted"),i.isCurrent=Object(s.V)(t,AudioUtils.AUDIO_CURRENT_CLS),i.isPlaying=Object(s.V)(t,AudioUtils.AUDIO_PLAYING_CLS),i.isFromCurrentPlaylist=!!Object(s.T)("_audio_section__current",t),i.isNumeric=!!Object(s.T)("audio_numeric",t),i.isWithCovers=!!Object(s.T)("audio_w_covers",t),i.withInlinePlayer=!i.isWithCovers&&!Object(s.T)("audio_no_inline_player",t),i.isInSnippet=!!Object(s.T)("_audio_pl_snippet__list",t),i.isInEditBox=!!Object(s.T)("_audio_pl_edit_box",t),i.isInRecomsBlock=!!Object(s.T)("_audio_recoms_blocks",t),i.isInFastChat=!!Object(s.T)("fc_tab",t),i.isInAttach=!!Object(s.T)("media_preview",t),i.isSetClaimed=Object(s.V)(t,"audio_moder_claimed"),i.isPodcastListSnippet=Object(s.V)(t,"podcast_list_snippet")),i},getAudioFullId:function(t){return t[a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[a.AUDIO_ITEM_INDEX_ID]},asObject:y,initDomPlaylist:function(t,e){var i=[];return each(e,function(t,e){e&&each(Object(s.G)("_audio_row",e),function(t){i.push(AudioUtils.getAudioFromEl(this))})}),t.addAudio(i),t},getContextPlaylist:function(t,e){var i=getAudioPlayer(),o=AudioUtils.getAudioFromEl(t,!0);function a(t){return[].slice.call(t)}var r=null,n=[],l=Object(s.s)(t,"new-post"),u=!1,d=null,_=AudioPlaylist.TYPE_TEMP,c=vk.id,p=void 0,h={},f=window.AudioPage&&currentAudioPage(t);if((window.traverseParent||function(t,e){for(t=Object(s.F)(t);t&&!e(t)&&(t=Object(s.z)(t))!=document;);return null})(t,function(t){return u=Object(s.s)(t,"audio-context")}),u=(u=o.context||u)||("audio"==cur.module?cur.submodule:cur.module),e)return{context:u};var A=AudioUtils.contextSplit(u),y=g(A,2),E=y[0],P=y[1],I=Object(s.T)("_audio_pl",t);if(I){var v=(Object(s.s)(I,"playlist-id")||"").split("_");d=i.getPlaylist.apply(i,v);var m=Object(s.s)(I,"title")||"";m&&d.mergeWith({title:clean(m)});var O=Object(s.s)(I,"access-hash")||"";O&&d.mergeWith({accessHash:O}),f&&f.getPageCurrentPlaylist()==d&&f.getSortedList()?d.initSortedList(f.getSortedList()):o.isFromCurrentPlaylist||(d.removeSortedList(),d.shuffle(0)),"music_2018_top_audios"===u&&(n=[Object(s.H)("audio_recoms_audios_block")])}else if(f&&f.getPageCurrentPlaylist())d=f.getPageCurrentPlaylist();else if("module"==E){var T=P;d=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,T||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),n=[r]}else if(0===o.context.indexOf("admin"))(d=i.getPlaylist.apply(i,[AudioPlaylist.TYPE_PLAYLIST].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(o.album)))).getAudiosCount()||d.setForceReload(!0);else if(0===o.context.indexOf("im"))r=(r=Object(s.T)("_im_peer_history",t))||Object(s.T)("_fc_tab_log_msgs",t),p="im"+(cur.peer||"");else if(0===o.context.indexOf("board"))p=o.context,n=a(Object(s.G)("_wall_audio_rows",r));else if(0===o.context.indexOf("widget"))p=o.context;else if(0===o.context.indexOf("wiki"))p="wiki";else if(0===o.context.indexOf("post")){_=AudioPlaylist.TYPE_WALL,p=o.context;var b=o.context.replace("post","").split("_");c=b[0],h={postId:b[1]}}else if(0===o.context.indexOf("choose"))p=o.context;else if("feed"==l||0===o.context.indexOf("feed")||0===o.context.indexOf("feedsearch"))p="feed",n=a(Object(s.G)("wall_text",r));else if("group_wall"==E||"user_wall"==E||0===o.context.indexOf("reply")||"wall"==l){_=AudioPlaylist.TYPE_WALL,c=cur.oid;var w=(P||"").split("_")[1],D=cur.wallQuery||"",L=Object(s.F)("wall_search"),S=inArray(cur.wallType,["own","full_own"])?"own":"all";p=hashCode(S+"_"+D),"wall"==cur.module&&Object(s.yb)(L)&&(D=Object(s.yb)(L)),w&&(h={postId:w,wallQuery:D,wallType:S}),0===o.context.indexOf("reply")&&(n=a([Object(s.T)("_replies_list",t)]),p="reply"+p),n=n.concat(a([r]))}else"article"==E&&(d=cur.articlePlaylist);return r||(r=Object(s.z)(t)),(n=n.filter(function(t){return!!t}))&&0!=n.length||(n=[r]),(d=(d=d||i.getPlaylist(_,c,p)).getAudiosCount()?d:AudioUtils.initDomPlaylist(d,n)).mergeWith(h||{}),-1==d.indexOfAudio(o)&&(d=AudioUtils.initDomPlaylist(d,[Object(s.z)(t)])),{playlist:d,context:u}},renderAudioDiag:function(){var t=Object(s.F)("audio_diag_log"),e=ls.get(AudioUtils.LOG_LS_KEY)||[];t&&each(e,function(e,i){var o=new Date(i.shift()).toUTCString();i=i.join(", "),t.appendChild(Object(s.mb)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+o+"</span>"+i+"</div>"))})},claim:function(t,e,i){Object(s.a)(e,"audio_moder_claimed"),AudioUtils.onRowOver(e,!1,!0),t=AudioUtils.asObject(t),ajax.post("al_claims.php",{act:"a_claim",claim_id:i,type:"audio",id:t.id,owner_id:t.ownerId})},unclaim:function(t,e,i){Object(s.hb)(e,"audio_moder_claimed"),AudioUtils.onRowOver(e,!1,!0),t=AudioUtils.asObject(t),ajax.post("al_claims.php",{act:"a_unclaim",claim_id:i,type:"audio",id:t.id,owner_id:t.ownerId,hash:t.actionHash})},getUMAInfo:function(t,e){e.isInEditBox||showBox("al_audio.php",{act:"get_uma_restrictions",id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{width:750}})},getUMAInfoAlbum:function(t,e){e.isInEditBox||showBox("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:t},{params:{width:750}})},cancelReplacement:function(t,e,i){ajax.post("al_audio.php",{act:"cancel_replacement",hash:e,audio_id:t}),Object(s.fb)(i)},removeFromGroup:function(t,e,i){var o=t+"_"+e;if(cur.audioPage._ownerId<0)var a=window.showBox("al_audio.php",{act:"delete_from_group_box",playlist_id:o,group_id:-cur.audioPage._ownerId}).setButtons(getLang("global_yes"),function(){ajax.post("al_audio.php",{act:"delete_from_group",group_id:-cur.audioPage._ownerId,hash:i,playlist_id:o},{onDone:function(t){a.hide(),showDoneBox(t)},onFail:function(t){return a.hide(),showDoneBox(t),!0}})},getLang("global_cancel"),function(){return a.hide()}).show()},addToGroupBox:function(t,e,i){var o=t+"_"+e,a=window.showBox("al_audio.php",{act:"add_to_groups_box",playlist_id:o,access_hash:i}).setButtons(getLang("Save"),function(){var t=[];for(var e in cur.wdd.follow_playlist_wwd.selected)t.push(cur.wdd.follow_playlist_wwd.selected[e][0]);t.length&&(Object(s.F)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:t,hash:Object(s.F)("add_playlist_to_group_hash").value,playlist_id:o},{onDone:function(t){a.hide(),showDoneBox(t)},onFail:function(t){return Object(s.F)("add_playlist_to_group_fail").innerHTML=t,!0}}))})},showAudioRestriction:function(t){if(!t)return!1;if((t=y(t)).restrictionStatus){if(t.actionHash){Object(k.d)("audio_restriction_popup","show",t.restrictionStatus);var e=showBox("al_audio.php",{act:"restriction_box",audio_id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{hideButtons:!0,onShow:function(){var e=curBox();e&&e.once("click:ok",function(){Object(k.d)("audio_restriction_popup","click",t.restrictionStatus)})},onHide:function(e){e||Object(k.d)("audio_restriction_popup","hide",t.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+t.restrictionStatus,onDone:function(e,i){if(i&&i.play){e.hide();var o=function(t){var e=Object(s.G)("_audio_row_"+t.fullId);if(!e||!e.length)return!1;var i=Object(U.m)(Object(s.s)(e[0],"audio"));if(!i)return!1;var o=Object(U.m)(i[a.AUDIO_ITEM_INDEX_EXTRA]);o&&delete o.claim,i[a.AUDIO_ITEM_INDEX_RESTRICTION]=0,i[a.AUDIO_ITEM_INDEX_FLAGS]&=~a.AUDIO_ITEM_CLAIMED_BIT,i[a.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(o);var r=Object(N.j)().getCurrentPlaylist(),n=Object(s.mb)(f(i,"no_extra"));if(r){var l=i[a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+i[a.AUDIO_ITEM_INDEX_ID],u=r.getAudio(l);u&&(u[a.AUDIO_ITEM_INDEX_RESTRICTION]=i[a.AUDIO_ITEM_INDEX_RESTRICTION],u[a.AUDIO_ITEM_INDEX_FLAGS]=i[a.AUDIO_ITEM_INDEX_FLAGS],u[a.AUDIO_ITEM_INDEX_EXTRA]=i[a.AUDIO_ITEM_INDEX_EXTRA])}return each(e,function(t,e){var o=t>0?Object(s.mb)(f(i,"no_extra")):n;e.parentElement.insertBefore(o,e),e.parentElement.removeChild(e)}),n}(i.audio?y(i.audio):t),r=Object(N.j)();o&&r.toggleAudio(o,{target:o})}},onFail:function(){e&&e.hide(),M(t)}})}else M(t);return!0}return!1},isPodcast:function(t){if(!t)return!1;var e=isObject(t)?t.extra:t[AudioUtils.AUDIO_ITEM_INDEX_EXTRA];return isObject(e)||(e=JSON.parse(e||"{}")),!!e.podcast},isPrivatePodcast:function(t){return!(!AudioUtils.isPodcast(t)||!AudioUtils.getAudioExtra(t).private)},PodcastsLogs:o,copyPlaylistLink:function(t,e,i){var o=location.protocol+"//"+location.host+"/music?z=audio_playlist"+t+"_"+e;i&&(o+="/"+i),statlogsValueEvent("audio_copy_link",vk.id),Object(T.b)(o),showDoneBox(getLang("audio_playlist_link_copied"))},connectListenQueue:C,getAlbumParts:function(t){if(t&&t.getAudiosCount()&&t.isFullyLoadable()&&!t.hasMore()){for(var e=t.getAudiosList(),i=t.getAudiosCount(),o=[],s=0,r=0;r<i;r++){var n=e[r][a.AUDIO_ITEM_INDEX_ALBUM_PART];n>s&&(s=n,o.push({number:n,offset:r}))}if(o.length>1)return o}return!1},drawAlbumPartRow:function(t){return'<div class="audio_album_part_row">'+getLang("audio_album_part").replace("{part}",t)+"</div>"},onRowOver:r.a,onRowLeave:function(t){Object(s.i)(t,"leaved",!0);var e=Object(s.i)(t,"tt");if((!e||!e.isShown())&&(clearTimeout(window.audioRowHoverTO),Object(s.i)(t,"actions"))){var i=Object(s.H)("_audio_row__actions",t),o=Object(s.H)("_audio_row__duration",t);re(i),Object(s.qb)(o,"visibility","visible"),Object(s.i)(t,"actions",0)}},onAudioAddedToPlaylist:function(t,e,i,o){getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,e).addAudio(o,0),each(Object(s.G)("_audio_pl_"+t+"_"+e),function(t,e){domReplaceEl(e,Object(s.mb)(i))})},onAudioChoose:function(t,e,i,o){if(Object(n.A)(e.selected)){var a=cur.attachCount&&cur.attachCount()||0,r=i.fullId+(i.accessKey?"_"+i.accessKey:"");if(cur.chooseMedia("audio",r,o),(!cur.attachCount||cur.attachCount()>a)&&cur.lastAddMedia){e.selected=cur.lastAddMedia.chosenMedias.length-1,Object(s.a)(Object(s.z)(e),"audio_selected");var u=Object(s.N)(e)[0];Object(s.qb)(e,"width",u),e.innerHTML=getLang("global_cancel")}}else cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,Object(s.hb)(Object(s.z)(e),"audio_selected"),e.innerHTML=getLang("global_add_media");return Object(l.c)(t)},onPlaylistChoose:function(t,e){var i=e.getAccessHash();cur.chooseMedia("audio_playlist",e.getOwnerId()+"_"+e.getPlaylistId()+(i?":"+i:""),{id:e.getPlaylistId(),ownerId:e.getOwnerId(),coverUrl:e.getCoverUrl(),gridCovers:e.getGridCovers(),title:e.getTitle(),authorName:e.getAuthorName(),authorHref:e.getAuthorHref(),accessHash:e.getAccessHash()})},_showPlaylistsChooser:function(t,e,i,o,a,r){var n=i.playlists,l=i.newPlaylistHash,u=i.morePlaylists;AudioUtils.copiedToPlaylistAudios=AudioUtils.copiedToPlaylistAudios||{},AudioUtils.copiedToPlaylistAudiosHashes=AudioUtils.copiedToPlaylistAudiosHashes||{};var d=e,_=Object(s.mb)(Object(s.lb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,getLang("audio_add_to_new_pl"),"audio_row__action_playlist"]));if(domInsertAfter(_,d),d=_,_.addEventListener("click",function(){AudioUtils.editPlaylist(o,!1,"edit",{addAudio:r,newPlaylistHash:l})}),each(n,function(t,e){var i=!0,o=e[0]+"_"+e[1]+"_"+a.fullId,r=AudioUtils.copiedToPlaylistAudios[o],n="audio_row__action_playlist";(e[3]||r)&&(i=!1,n+=" audio_row__more_playlist_added");var l=Object(s.mb)(Object(s.lb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+e[0]+"_"+e[1],0,e[2],n]));domInsertAfter(l,d),d=l;var u=!1;l.addEventListener("click",function(){if(!u){u=!0;var t=a.ownerId,r=a.id,n=AudioUtils.copiedToPlaylistAudios[o];n&&(t=(n=n.split("_"))[0],r=n[1]),i&&(AudioUtils.copiedToPlaylistAudiosHashes[o]=e[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:e[4],playlist_id:e[1],playlist_owner_id:e[0],audio_owner_id:t,audio_id:r,do_add:intval(i)},{onDone:function(t,a,s){AudioUtils.copiedToPlaylistAudios[o]=!!i&&s,e[4]=i?t:AudioUtils.copiedToPlaylistAudiosHashes[o],i=!i,u=!1}}),Object(s.vb)(l,"audio_row__more_playlist_added",i)}})}),u){var c=Object(s.mb)(Object(s.lb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,getLang("audio_row_show_all_playlists"),"audio_row__action_playlist"]));c.addEventListener("click",function(){showBox("al_audio.php?act=more_playlists_add",{owner_id:o,audio_owner_id:a.ownerId,audio_id:a.id},{params:{bodyStyle:"padding: 0px",width:560}})}),domInsertAfter(c,d),d=c}t.updatePosition()},debugLog:function(){}})}}]);try{stManager.done("cmodules/bundles/audioplayer.js")}catch(t){}